/**
 * @license
 * KLineChart v8.2.0
 * Copyright (c) 2019 lihu.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).klinecharts={})}(this,(function(t){"use strict";var e={technicalIndicatorExtensions:{},shapeExtensions:{},addTechnicalIndicatorTemplate:function(t){var e=this;t&&[].concat(t).forEach((function(t){t.name&&(e.technicalIndicatorExtensions[t.name]=t)}))},addShapeTemplate:function(t){var e=this;t&&[].concat(t).forEach((function(t){t.name&&(e.shapeExtensions[t.name]=t)}))}};function i(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function a(t){for(var e=1;arguments.length>e;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?i(Object(a),!0).forEach((function(e){h(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var i=0;e.length>i;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function r(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function h(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&u(t,e)}function l(t){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},l(t)}function u(t,e){return u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},u(t,e)}function d(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,a=l(t);if(e){var n=l(this).constructor;i=Reflect.construct(a,arguments,n)}else i=a.apply(this,arguments);return d(this,i)}}function v(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=l(t)););return t}function f(){return f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var a=v(t,e);if(a){var n=Object.getOwnPropertyDescriptor(a,e);return n.get?n.get.call(3>arguments.length?t:i):n.value}},f.apply(this,arguments)}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,a=Array(e);e>i;i++)a[i]=t[i];return a}function m(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return p(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?p(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var a=0,n=function(){};return{s:n,n:function(){return t.length>a?{done:!1,value:t[a++]}:{done:!0}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,r=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return o=t.done,t},e:function(t){r=!0,s=t},f:function(){try{o||null==i.return||i.return()}finally{if(r)throw s}}}}function y(t,e){if(k(t)&&k(e))for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&i in t){var a=t[i],n=e[i];k(n)&&k(a)&&!g(n)&&!g(a)?y(a,n):b(e[i])&&(t[i]=e[i])}}function x(t){if(!k(t))return t;var e;for(var i in e=g(t)?[]:{},t)if(Object.prototype.hasOwnProperty.call(t,i)){var a=t[i];e[i]=k(a)?x(a):a}return e}function g(t){return"[object Array]"===Object.prototype.toString.call(t)}function S(t){return t&&"function"==typeof t}function k(t){return!!t&&"object"===n(t)}function w(t){return"number"==typeof t&&!isNaN(t)}function b(t){return null!=t}function E(t){return"boolean"==typeof t}function P(t){return"string"==typeof t}var C="stroke",A="fill",T="dash",I="solid",M="left",D="right",L="normal",O="percentage",F="log",z="candle_solid",R="candle_stroke",B="candle_up_stroke",H="candle_down_stroke",V="ohlc",Y="area",W="always",N="follow_cross",j="rect",X="standard",G="circle",Z="rect",U="triangle",K="diamond",q="custom",$="point",J="top",Q="bottom",tt={grid:{show:!0,horizontal:{show:!0,size:1,color:"#EDEDED",style:T,dashValue:[2,2]},vertical:{show:!0,size:1,color:"#EDEDED",style:T,dashValue:[2,2]}},candle:{margin:{top:.2,bottom:.1},type:z,bar:{upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#999999"},area:{lineSize:2,lineColor:"#2196F3",value:"close",backgroundColor:[{offset:0,color:"rgba(33, 150, 243, 0.01)"},{offset:1,color:"rgba(33, 150, 243, 0.2)"}]},priceMark:{show:!0,high:{show:!0,color:"#76808F",textMargin:5,textSize:10,textFamily:"Helvetica Neue",textWeight:"normal"},low:{show:!0,color:"#76808F",textMargin:5,textSize:10,textFamily:"Helvetica Neue",textWeight:"normal"},last:{show:!0,upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#888888",line:{show:!0,style:T,dashValue:[4,4],size:1},text:{show:!0,size:12,paddingLeft:2,paddingTop:2,paddingRight:2,paddingBottom:2,color:"#FFFFFF",family:"Helvetica Neue",weight:"normal",borderRadius:2}}},tooltip:{showRule:W,showType:X,labels:["时间: ","开: ","收: ","高: ","低: ","成交量: "],values:null,defaultValue:"n/a",rect:{paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:6,offsetLeft:8,offsetTop:8,offsetRight:8,borderRadius:4,borderSize:1,borderColor:"#F2F3F5",backgroundColor:"#FEFEFE"},text:{size:12,family:"Helvetica Neue",weight:"normal",color:"#76808F",marginLeft:8,marginTop:6,marginRight:8,marginBottom:0}}},technicalIndicator:{margin:{top:.2,bottom:.1},bar:{upColor:"rgba(38, 166, 154, .65)",downColor:"rgba(239, 83, 80, .65)",noChangeColor:"#888888"},line:{size:1,colors:["#FF9600","#9D65C9","#2196F3","#E11D74","#01C5C4"]},circle:{upColor:"rgba(38, 166, 154, .65)",downColor:"rgba(239, 83, 80, .65)",noChangeColor:"#888888"},lastValueMark:{show:!1,text:{show:!1,color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",paddingLeft:3,paddingTop:2,paddingRight:3,paddingBottom:2,borderRadius:2}},tooltip:{showRule:W,showType:X,showName:!0,showParams:!0,defaultValue:"n/a",text:{size:12,family:"Helvetica Neue",weight:"normal",color:"#76808F",marginTop:6,marginRight:8,marginBottom:0,marginLeft:8}}},xAxis:{show:!0,height:null,axisLine:{show:!0,color:"#DDDDDD",size:1},tickText:{show:!0,color:"#76808F",size:12,family:"Helvetica Neue",weight:"normal",paddingTop:3,paddingBottom:6},tickLine:{show:!0,size:1,length:3,color:"#DDDDDD"}},yAxis:{show:!0,width:null,type:L,position:D,inside:!1,axisLine:{show:!0,color:"#DDDDDD",size:1},tickText:{show:!0,color:"#76808F",size:12,family:"Helvetica Neue",weight:"normal",paddingLeft:3,paddingRight:6},tickLine:{show:!0,size:1,length:3,color:"#DDDDDD"}},separator:{size:1,color:"#DDDDDD",fill:!0,activeBackgroundColor:"rgba(33, 150, 243, 0.08)"},crosshair:{show:!0,horizontal:{show:!0,line:{show:!0,style:T,dashValue:[4,2],size:1,color:"#76808F"},text:{show:!0,color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",paddingLeft:2,paddingRight:2,paddingTop:2,paddingBottom:2,borderSize:1,borderColor:"#686D76",borderRadius:2,backgroundColor:"#686D76"}},vertical:{show:!0,line:{show:!0,style:T,dashValue:[4,2],size:1,color:"#76808F"},text:{show:!0,color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",paddingLeft:2,paddingRight:2,paddingTop:2,paddingBottom:2,borderSize:1,borderRadius:2,borderColor:"#686D76",backgroundColor:"#686D76"}}},shape:{point:{backgroundColor:"#2196F3",borderColor:"rgba(33, 150, 243, 0.35)",borderSize:1,radius:5,activeBackgroundColor:"#2196F3",activeBorderColor:"rgba(33, 150, 243, 0.35)",activeBorderSize:3,activeRadius:5},line:{style:I,color:"#2196F3",size:1,dashValue:[2,2]},polygon:{style:C,stroke:{style:I,size:1,color:"#2196F3",dashValue:[2,2]},fill:{color:"#2196F3"}},arc:{style:C,stroke:{style:I,size:1,color:"#2196F3",dashValue:[2,2]},fill:{color:"#2196F3"}},text:{style:A,color:"#2196F3",size:12,family:"Helvetica Neue",weight:"normal",offset:[0,0]}},annotation:{position:J,offset:[20,0],symbol:{type:K,size:8,color:"#2196F3",activeSize:10,activeColor:"#FF9600"}},tag:{position:$,offset:0,line:{show:!0,style:T,dashValue:[4,2],size:1,color:"#2196F3"},text:{color:"#FFFFFF",backgroundColor:"#2196F3",size:12,family:"Helvetica Neue",weight:"normal",paddingLeft:2,paddingRight:2,paddingTop:2,paddingBottom:2,borderRadius:2,borderSize:1,borderColor:"#2196F3"},mark:{offset:0,color:"#FFFFFF",backgroundColor:"#2196F3",size:12,family:"Helvetica Neue",weight:"normal",paddingLeft:2,paddingRight:2,paddingTop:2,paddingBottom:2,borderRadius:2,borderSize:1,borderColor:"#2196F3"}}};function et(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"--";if(k(t)){var a=t[e];if(b(a))return a}return i}function it(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"MM-DD hh:mm";if(w(e)){var a=t.format(new Date(e)),n=a.split(", "),s=n[0].split("/"),o={YYYY:s[2],MM:s[0],DD:s[1],"hh:mm":"24"===n[1].match(/^[\d]{2}/)[0]?n[1].replace(/^[\d]{2}/,"00"):n[1]};return i.replace(/YYYY|MM|DD|(hh:mm)/g,(function(t){return o[t]}))}return"--"}function at(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=+t;return(i||0===i)&&w(i)?i.toFixed(e):"".concat(i)}function nt(t){return w(+t)?t>1e9?"".concat(+(t/1e9).toFixed(3),"B"):t>1e6?"".concat(+(t/1e6).toFixed(3),"M"):t>1e3?"".concat(+(t/1e3).toFixed(3),"K"):t:"--"}function st(t,e){return null==e&&(e=10),+(t=(+t).toFixed(e=Math.min(Math.max(0,e),20)))}function ot(t){return Math.log(t)/Math.log(10)}function rt(t){return Math.pow(10,t)}var ht={ZOOM:"zoom",SCROLL:"scroll",CROSSHAIR:"crosshair",TOOLTIP:"tooltip",PANE_DRAG:"pane_drag"};function ct(t){return Object.values(ht).indexOf(t)>-1}var lt=function(){function t(e){s(this,t),this._chartStore=e,this._dateTimeFormat=new Intl.DateTimeFormat("en",{hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),this._zoomEnabled=!0,this._scrollEnabled=!0,this._loading=!0,this._loadMoreCallback=null,this._more=!0,this._totalDataSpace=0,this._dataSpace=6,this._barSpace=this._calcBarSpace(),this._offsetRightSpace=50,this._offsetRightBarCount=this._offsetRightSpace/this._dataSpace,this._leftMinVisibleBarCount=2,this._rightMinVisibleBarCount=2,this._from=0,this._to=0,this._preOffsetRightBarCount=0}return r(t,[{key:"_calcBarSpace",value:function(){return Math.max(1,Math.min(Math.floor(.82*this._dataSpace),Math.floor(this._dataSpace)-1))}},{key:"adjustFromTo",value:function(){var t=this._chartStore.dataList().length,e=this._totalDataSpace/this._dataSpace,i=e-Math.min(this._leftMinVisibleBarCount,t);this._offsetRightBarCount>i&&(this._offsetRightBarCount=i);var a=-t+Math.min(this._rightMinVisibleBarCount,t);a>this._offsetRightBarCount&&(this._offsetRightBarCount=a),this._to=Math.round(this._offsetRightBarCount+t+.5),this._from=Math.round(this._to-e)-1,this._to>t&&(this._to=t),0>this._from&&(this._from=0),this._chartStore.adjustVisibleDataList(),0===this._from&&this._more&&!this._loading&&S(this._loadMoreCallback)&&(this._loading=!0,this._loadMoreCallback(et(this._chartStore.dataList()[0],"timestamp")))}},{key:"setMore",value:function(t){this._more=t}},{key:"setLoading",value:function(t){this._loading=t}},{key:"dateTimeFormat",value:function(){return this._dateTimeFormat}},{key:"setTimezone",value:function(t){var e;try{e=new Intl.DateTimeFormat("en",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch(t){}e&&(this._dateTimeFormat=e)}},{key:"timezone",value:function(){return this._dateTimeFormat.resolvedOptions().timeZone}},{key:"dataSpace",value:function(){return this._dataSpace}},{key:"barSpace",value:function(){return this._barSpace}},{key:"halfBarSpace",value:function(){return this._barSpace/2}},{key:"setDataSpace",value:function(t,e){1>t||t>50||this._dataSpace===t||(this._dataSpace=t,this._barSpace=this._calcBarSpace(),e&&e(),this.adjustFromTo(),this._chartStore.crosshairStore().recalculate(!0),this._chartStore.invalidate())}},{key:"setTotalDataSpace",value:function(t){this._totalDataSpace!==t&&(this._totalDataSpace=t,this.adjustFromTo(),this._chartStore.crosshairStore().recalculate(!0))}},{key:"setOffsetRightSpace",value:function(t,e){this._offsetRightSpace=t,this._offsetRightBarCount=t/this._dataSpace,e&&(this.adjustFromTo(),this._chartStore.crosshairStore().recalculate(!0),this._chartStore.invalidate())}},{key:"resetOffsetRightSpace",value:function(){this.setOffsetRightSpace(this._offsetRightSpace)}},{key:"offsetRightSpace",value:function(){return this._offsetRightSpace}},{key:"offsetRightBarCount",value:function(){return this._offsetRightBarCount}},{key:"setOffsetRightBarCount",value:function(t){this._offsetRightBarCount=t}},{key:"setLeftMinVisibleBarCount",value:function(t){this._leftMinVisibleBarCount=t}},{key:"setRightMinVisibleBarCount",value:function(t){this._rightMinVisibleBarCount=t}},{key:"from",value:function(){return this._from}},{key:"to",value:function(){return this._to}},{key:"startScroll",value:function(){this._preOffsetRightBarCount=this._offsetRightBarCount}},{key:"scroll",value:function(t,e){if(this._scrollEnabled){var i=t/this._dataSpace;this._chartStore.actionStore().execute(ht.SCROLL,{barCount:i,distance:t}),this._offsetRightBarCount=this._preOffsetRightBarCount-i,this.adjustFromTo();var a=e||this._chartStore.crosshairStore().get();this._chartStore.crosshairStore().set(a,!0),this._chartStore.invalidate()}}},{key:"getDataByDataIndex",value:function(t){return this._chartStore.dataList()[t]}},{key:"coordinateToFloatIndex",value:function(t){var e=this._chartStore.dataList().length;return Math.round(1e6*(e+this._offsetRightBarCount-(this._totalDataSpace-t)/this._dataSpace))/1e6}},{key:"dataIndexToTimestamp",value:function(t){var e=this.getDataByDataIndex(t);if(e)return e.timestamp}},{key:"timestampToDataIndex",value:function(t){return 0===this._chartStore.dataList().length?0:function(t,e,i){var a=0,n=0;for(n=t.length-1;a!==n;){var s=Math.floor((n+a)/2),o=n-a,r=t[s][e];if(i===t[a][e])return a;if(i===t[n][e])return n;if(i===r)return s;if(i>r?a=s:n=s,2>=o)break}return a}(this._chartStore.dataList(),"timestamp",t)}},{key:"dataIndexToCoordinate",value:function(t){var e=this._chartStore.dataList().length;return this._totalDataSpace-(e+this._offsetRightBarCount-t-.5)*this._dataSpace}},{key:"coordinateToDataIndex",value:function(t){return Math.ceil(this.coordinateToFloatIndex(t))-1}},{key:"zoom",value:function(t,e){var i=this;if(this._zoomEnabled){if(!e||!b(e.x)){var a=this._chartStore.crosshairStore().get();e={x:b(a.x)?a.x:this._totalDataSpace/2}}this._chartStore.actionStore().execute(ht.ZOOM,{coordinate:e,scale:t});var n=this.coordinateToFloatIndex(e.x);this.setDataSpace(this._dataSpace+t*(this._dataSpace/10),(function(){i._offsetRightBarCount+=n-i.coordinateToFloatIndex(e.x)}))}}},{key:"setZoomEnabled",value:function(t){this._zoomEnabled=t}},{key:"zoomEnabled",value:function(){return this._zoomEnabled}},{key:"setScrollEnabled",value:function(t){this._scrollEnabled=t}},{key:"scrollEnabled",value:function(){return this._scrollEnabled}},{key:"setLoadMoreCallback",value:function(t){this._loadMoreCallback=t}},{key:"clear",value:function(){this._more=!0,this._loading=!0,this._from=0,this._to=0}}]),t}(),ut="line",dt="bar",_t="circle",vt={PRICE:"price",VOLUME:"volume",NORMAL:"normal"};function ft(t,e,i,a,n,s){var o=s.color,r=s.isStroke,h={prev:{kLineData:t[i-1],technicalIndicatorData:e[i-1]},current:{kLineData:t[i],technicalIndicatorData:e[i]},next:{kLineData:t[i+1],technicalIndicatorData:e[i+1]}};return b(a.color)&&(o=S(a.color)?a.color(h,n)||s.color:a.color||s.color),b(a.isStroke)&&(r=S(a.isStroke)?a.isStroke(h):a.isStroke),{color:o,isStroke:r}}var pt=function(){function t(e){var i=e.name,a=e.shortName,n=e.series,o=e.calcParams,r=e.plots,h=e.precision,c=e.shouldCheckParamCount,l=e.shouldOhlc,u=e.shouldFormatBigNumber,d=e.minValue,_=e.maxValue,v=e.styles;s(this,t),this.name=i||"",this.shortName=a||i||"",this.series=-1!==Object.values(vt).indexOf(n)?n:vt.NORMAL,this.precision=w(h)&&h>=0?h:4,this._precisionFlag=!1,this.calcParams=g(o)?o:[],this.plots=g(r)?r:[],this.shouldCheckParamCount=!E(c)||c,this.shouldOhlc=!!E(l)&&l,this.shouldFormatBigNumber=!!E(u)&&u,this.minValue=d,this.maxValue=_,this.styles=v,this.result=[]}return r(t,[{key:"_createParams",value:function(t){return t.map((function(t){return k(t)?t.value:t}))}},{key:"setShortName",value:function(t){return this.shortName!==t&&(this.shortName=t,!0)}},{key:"setPrecision",value:function(t,e){return!(!w(t)||0>t||e&&(!e||this._precisionFlag))&&(this.precision=parseInt(t,10),e||(this._precisionFlag=!0),!0)}},{key:"setCalcParams",value:function(t){if(!g(t))return!1;if(this.shouldCheckParamCount&&t.length!==this.calcParams.length)return!1;for(var e=[],i=0;t.length>i;i++){var a=t[i],n=void 0,s=void 0;k(a)?(n=a.value,s=a.allowDecimal):(n=a,s=!1);var o=this.calcParams[i];if(k(o)&&E(o.allowDecimal)&&(s=o.allowDecimal),!w(n)||0>=n||!s&&parseInt(n,10)!==n)return!1;e.push({allowDecimal:s,value:n})}this.calcParams=e;var r=this.regeneratePlots(this._createParams(e));return r&&g(r)&&(this.plots=r),!0}},{key:"setShouldOhlc",value:function(t){return!(!E(t)||this.shouldOhlc===t)&&(this.shouldOhlc=t,!0)}},{key:"setShouldFormatBigNumber",value:function(t){return!(!E(t)||this.shouldFormatBigNumber===t)&&(this.shouldFormatBigNumber=t,!0)}},{key:"setStyles",value:function(t,e){return!!k(t)&&(this.styles||(this.styles={margin:x(e.margin),bar:x(e.bar),line:x(e.line),circle:x(e.circle)}),y(this.styles,t),!0)}},{key:"calc",value:function(t){this.result=this.calcTechnicalIndicator(t,{params:this._createParams(this.calcParams),plots:this.plots})||[]}},{key:"calcTechnicalIndicator",value:function(t,e){}},{key:"regeneratePlots",value:function(t){}}]),t}(),mt=function(){function t(e){s(this,t),this._chartStore=e,this._templates=this._createTemplates(),this._instances=new Map}return r(t,[{key:"_createTechInfo",value:function(t){return{name:t.name,shortName:t.shortName,series:t.series,calcParams:t.calcParams,shouldCheckParamCount:t.shouldCheckParamCount,shouldOhlc:t.shouldOhlc,shouldFormatBigNumber:t.shouldFormatBigNumber,precision:t.precision,styles:t.styles,plots:t.plots,result:t.result||[]}}},{key:"_createTemplates",value:function(){var t={},i=e.technicalIndicatorExtensions;for(var a in i){var n=this._createTemplateInstance(i[a]);n&&(t[a]=n)}return t}},{key:"_createTemplateInstance",value:function(t){var e=t.name,i=t.shortName,a=t.series,n=t.calcParams,o=t.plots,h=t.precision,l=t.shouldCheckParamCount,u=t.shouldOhlc,d=t.shouldFormatBigNumber,v=t.minValue,f=t.maxValue,p=t.styles,m=t.calcTechnicalIndicator,y=t.regeneratePlots,x=t.render;if(!e||!S(m))return null;var g=function(t){c(y,t);var m=_(y);function y(){return s(this,y),m.call(this,{name:e,shortName:i,series:a,calcParams:n,plots:o,precision:h,shouldCheckParamCount:l,shouldOhlc:u,shouldFormatBigNumber:d,minValue:v,maxValue:f,styles:p})}return r(y)}(pt);return g.prototype.calcTechnicalIndicator=m,S(y)&&(g.prototype.regeneratePlots=y),S(x)&&(g.prototype.render=x),new g}},{key:"addTemplate",value:function(t){var e=this;t.forEach((function(t){var i=e._createTemplateInstance(t||{});i&&(e._templates[i.name]=i)}))}},{key:"hasTemplate",value:function(t){return!!this._templates[t]}},{key:"getTemplateInfo",value:function(t){if(!b(t)){var e={};for(var i in this._templates){e[i]=this._createTechInfo(this._templates[i])}return e}var a=this._templates[t];return a?this._createTechInfo(a):{}}},{key:"addInstance",value:function(t,e,i){if(e){var a=e.name,n=e.calcParams,s=e.precision,o=e.shouldOhlc,r=e.shouldFormatBigNumber,h=e.styles,c=this._instances.get(t);if(c&&c.has(a))return!1;c||(c=new Map,this._instances.set(t,c));var l,u=this._templates[a];if(u)for(var d in l=Object.create(Object.getPrototypeOf(u)),u)Object.prototype.hasOwnProperty.call(u,d)&&(l[d]=u[d]);if(l)return l.setCalcParams(n),l.setPrecision(s),l.setShouldOhlc(o),l.setShouldFormatBigNumber(r),l.setStyles(h,this._chartStore.styleOptions().technicalIndicator),i||c.clear(),c.set(a,l),l.calc(this._chartStore.dataList()),!0}return!1}},{key:"instances",value:function(t){return this._instances.get(t)||new Map}},{key:"removeInstance",value:function(t,e){var i=!1;if(this._instances.has(t)){var a=this._instances.get(t);b(e)?a.has(e)&&(a.delete(e),i=!0):(a.clear(),i=!0),0===a.size&&this._instances.delete(t)}return i}},{key:"hasInstance",value:function(t){return this._instances.has(t)}},{key:"calcInstance",value:function(t,e){var i=this;if(b(t))if(b(e)){var a=this._instances.get(e);a&&a.has(t)&&a.get(t).calc(this._chartStore.dataList())}else this._instances.forEach((function(e){e.has(t)&&e.get(t).calc(i._chartStore.dataList())}));else this._instances.forEach((function(t){t.forEach((function(t){t.calc(i._chartStore.dataList())}))}))}},{key:"getInstanceInfo",value:function(t,e){var i=this,a=function(t){var a,n=[],s=m(t);try{for(s.s();!(a=s.n()).done;){var o=a.value[1];if(o){var r=i._createTechInfo(o);if(o.name===e)return r;n.push(r)}}}catch(t){s.e(t)}finally{s.f()}return n};if(!b(t)){var n={};return this._instances.forEach((function(t,e){n[e]=a(t)})),n}return this._instances.has(t)?a(this._instances.get(t)):{}}},{key:"setSeriesPrecision",value:function(t,e){var i=function(i){i.series===vt.PRICE&&i.setPrecision(t,!0),i.series===vt.VOLUME&&i.setPrecision(e,!0)};for(var a in this._templates)i(this._templates[a]);this._instances.forEach((function(t){t.forEach((function(t){i(t)}))}))}},{key:"override",value:function(t,e){var i=this,a=t.name,n=t.shortName,s=t.calcParams,o=t.precision,r=t.shouldOhlc,h=t.shouldFormatBigNumber,c=t.styles,l=this._chartStore.styleOptions().technicalIndicator,u=new Map;if(b(e))this._instances.has(e)&&u.set(e,this._instances.get(e));else{u=this._instances;var d=this._templates[a];d&&(d.setCalcParams(s),d.setShortName(n),d.setPrecision(o),d.setShouldOhlc(r),d.setShouldFormatBigNumber(h),d.setStyles(c,l))}var _=!1,v=[];if(u.forEach((function(t){if(t.has(a)){var e=t.get(a),u=e.setShortName(n),d=e.setCalcParams(s),f=e.setPrecision(o),p=e.setShouldOhlc(r),m=e.setShouldFormatBigNumber(h),y=e.setStyles(c,l);(u||d||f||p||m||y)&&(_=!0),d&&v.push(Promise.resolve(e.calc(i._chartStore.dataList())))}})),_)return Promise.all(v)}}]),t}();function yt(t,e){e.forEach((function(e){var i=e.key,a=e.fn;S(a)&&(t[i]=a)}))}var xt=function(){function t(e){var i=e.id,a=e.chartStore,n=e.xAxis,o=e.yAxis;s(this,t),this._id=i,this._chartStore=a,this._xAxis=n,this._yAxis=o,this._styles=null}return r(t,[{key:"draw",value:function(t){}},{key:"setStyles",value:function(t,e){return!!k(t)&&(this._styles||(this._styles=x(e)),y(this._styles,t),!0)}},{key:"id",value:function(){return this._id}},{key:"styles",value:function(){return this._styles}},{key:"setYAxis",value:function(t){t&&(this._yAxis=t)}},{key:"checkEventCoordinateOn",value:function(t){}},{key:"onClick",value:function(t){}},{key:"onRightClick",value:function(t){}},{key:"onMouseEnter",value:function(t){}},{key:"onMouseLeave",value:function(t){}}]),t}();function gt(t,e,i,a){t.fillStyle=e,t.beginPath(),t.arc(i.x,i.y,a,0,2*Math.PI),t.closePath(),t.fill()}function St(t,e,i){var a=Math.abs(e.x-t.x),n=Math.abs(e.y-t.y),s=Math.abs(i.x-t.x);return Math.abs(a*Math.abs(i.y-t.y)-s*n)/2}function kt(t,e,i){if(!i)return!1;var a=i.x-t.x,n=i.y-t.y;return!(a*a+n*n>e*e)}function wt(t,e,i){t.save(),t.lineWidth%2&&t.translate(.5,.5),t.beginPath();var a=!0;e.forEach((function(e){e&&(a?(t.moveTo(e.x,e.y),a=!1):t.lineTo(e.x,e.y))})),i(),t.restore()}function bt(t,e){wt(t,e,(function(){t.stroke(),t.closePath()}))}function Et(t,e){wt(t,e,(function(){t.closePath(),t.fill()}))}function Pt(t,e,i,a){t.beginPath();var n=t.lineWidth%2?.5:0;t.moveTo(i,e+n),t.lineTo(a,e+n),t.stroke(),t.closePath()}function Ct(t,e,i,a){t.beginPath();var n=t.lineWidth%2?.5:0;t.moveTo(e+n,i),t.lineTo(e+n,a),t.stroke(),t.closePath()}function At(t,e){bt(t,e)}function Tt(t){return t.ownerDocument&&t.ownerDocument.defaultView&&t.ownerDocument.defaultView.devicePixelRatio||2}function It(t,e){return Math.round(t.measureText(e).width)}function Mt(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Helvetica Neue";return"".concat(e," ").concat(t,"px ").concat(i)}function Dt(t,e,i){t.font=Mt(i.size,i.weight,i.family);var a=It(t,e);return i.paddingLeft+i.paddingRight+a+2*(i.borderSize||0)}function Lt(t){return t.paddingTop+t.paddingBottom+t.size+2*(t.borderSize||0)}var Ot="other",Ft="point",zt="none",Rt="line",Bt="text",Ht="continuous_line",Vt="polygon",Yt="arc",Wt=0,Nt=1,jt=2,Xt={NORMAL:"normal",WEAK_MAGNET:"weak_magnet",STRONG_MAGNET:"strong_magnet"};var Gt=function(t){c(i,t);var e=_(i);function i(t){var a,n=t.id,o=t.name,r=t.totalStep,h=t.chartStore,c=t.xAxis,l=t.yAxis,u=t.points,d=t.styles,_=t.lock,v=t.data;return s(this,i),(a=e.call(this,{id:n,chartStore:h,xAxis:c,yAxis:l}))._name=o,a._totalStep=r,a._lock=_,a._mode=Xt.NORMAL,a._data=v,a._drawStep=1,a._points=[],a.setPoints(u),a.setStyles(d,h.styleOptions().shape),a._prevPressPoint=null,a._prevPoints=null,a._coordinates=[],a}return r(i,[{key:"setPoints",value:function(t){if(g(t)&&t.length>0){var e;this._totalStep-1>t.length?(this._drawStep=t.length+1,this._points=x(t),e=t.length):(this._drawStep=-1,this._points=t.slice(0,this._totalStep-1),e=this._totalStep-1);for(var i=0;e>i;i++)this.performEventMoveForDrawing({step:i+2,mode:this._mode,points:this._points,movePoint:this._points[i],xAxis:this._xAxis,yAxis:this._yAxis});-1===this._drawStep&&this.performEventPressedMove({mode:this._mode,points:this._points,pressPointIndex:this._points.length-1,pressPoint:this._points[this._points.length-1],xAxis:this._xAxis,yAxis:this._yAxis})}}},{key:"_timestampOrDataIndexToCoordinateX",value:function(t){var e=t.timestamp,i=t.dataIndex;return e&&(i=this._chartStore.timeScaleStore().timestampToDataIndex(e)),this._xAxis.convertToPixel(i)}},{key:"_drawLines",value:function(t,e,i,a){t.save(),t.strokeStyle=i.color||a.color,t.lineWidth=i.size||a.size,i.style===T&&t.setLineDash(i.dashValue||a.dashValue),e.forEach((function(e){var i,a;if(e.length>1)switch((i=e[0]).x===(a=e[1]).x?jt:i.y===a.y?Nt:Wt){case Wt:At(t,e);break;case Nt:Pt(t,e[0].y,e[0].x,e[1].x);break;case jt:Ct(t,e[0].x,e[0].y,e[1].y)}})),t.restore()}},{key:"_drawContinuousLines",value:function(t,e,i,a){t.save(),t.strokeStyle=i.color||a.color,t.lineWidth=i.size||a.size,i.style===T&&t.setLineDash(i.dashValue||a.dashValue),e.forEach((function(e){e.length>0&&At(t,e)})),t.restore()}},{key:"_drawPolygons",value:function(t,e,i,a){var n;if(t.save(),i.style===A)t.fillStyle=(i.fill||a.fill).color,n=Et;else{var s=i.stroke||a.stroke;s.style===T&&t.setLineDash(s.dashValue),t.lineWidth=s.size,t.strokeStyle=s.color,n=bt}e.forEach((function(e){e.length>0&&n(t,e)})),t.restore()}},{key:"_drawArcs",value:function(t,e,i,a){if(t.save(),i.style===A)t.fillStyle=(i.fill||a.fill).color;else{var n=i.stroke||a.stroke;n.style===T&&t.setLineDash(n.dashValue),t.lineWidth=n.size,t.strokeStyle=n.color}e.forEach((function(e){var a=e.x,n=e.y,s=e.radius,o=e.startAngle,r=e.endAngle;t.beginPath(),t.arc(a,n,s,o,r),i.style===A?(t.closePath(),t.fill()):(t.stroke(),t.closePath())})),t.restore()}},{key:"_drawText",value:function(t,e,i,a){var n;t.save(),i.style===C?(t.strokeStyle=i.color||a.color,n=t.strokeText):(t.fillStyle=i.color||a.color,n=t.fillText),t.font=Mt(i.size||a.size,i.family||a.family,i.weight||a.weight);var s=i.offset||a.offset||[0,0];e.forEach((function(e){n.call(t,e.text,e.x+s[1],e.y+s[0])})),t.restore()}},{key:"draw",value:function(t){var e=this;this._coordinates=this._points.map((function(t){var i=t.value;return{x:e._timestampOrDataIndexToCoordinateX({timestamp:t.timestamp,dataIndex:t.dataIndex}),y:e._yAxis.convertToPixel(i)}}));var i=this._styles||this._chartStore.styleOptions().shape;if(1!==this._drawStep&&this._coordinates.length>0){var a={width:this._xAxis.width(),height:this._yAxis.height()},n={price:this._chartStore.pricePrecision(),volume:this._chartStore.volumePrecision()};this._shapeDataSources=this.createShapeDataSource({step:this._drawStep,mode:this._mode,points:this._points,coordinates:this._coordinates,viewport:{width:this._xAxis.width(),height:this._yAxis.height()},precision:{price:this._chartStore.pricePrecision(),volume:this._chartStore.volumePrecision()},styles:i,xAxis:this._xAxis,yAxis:this._yAxis,data:this._data})||[],this._shapeDataSources.forEach((function(a){var n=a.styles,s=a.dataSource,o=void 0===s?[]:s;if(a.isDraw)switch(a.type){case Rt:e._drawLines(t,o,n||i.line,i.line);break;case Ht:e._drawContinuousLines(t,o,n||i.line,i.line);break;case Vt:e._drawPolygons(t,o,n||i.polygon,i.polygon);break;case Yt:e._drawArcs(t,o,n||i.arc,i.arc);break;case Bt:e._drawText(t,o,n||i.text,i.text)}})),this.drawExtend&&(t.save(),this.drawExtend({ctx:t,dataSource:this._shapeDataSources,styles:i,viewport:a,precision:n,mode:this._mode,xAxis:this._xAxis,yAxis:this._yAxis,data:this._data}),t.restore())}var s=this._chartStore.shapeStore().mouseOperate();(s.hover.id===this._id&&s.hover.element!==zt||s.click.id===this._id&&s.click.element!==zt||this.isDrawing())&&this._coordinates.forEach((function(a,n){var o=a.x,r=a.y,h=i.point.radius,c=i.point.backgroundColor,l=i.point.borderColor,u=i.point.borderSize;s.hover.id===e._id&&s.hover.element===Ft&&n===s.hover.elementIndex&&(h=i.point.activeRadius,c=i.point.activeBackgroundColor,l=i.point.activeBorderColor,u=i.point.activeBorderSize),gt(t,l,{x:o,y:r},h+u),gt(t,c,{x:o,y:r},h)}))}},{key:"setLock",value:function(t){this._lock=t}},{key:"name",value:function(){return this._name}},{key:"lock",value:function(){return this._lock}},{key:"totalStep",value:function(){return this._totalStep}},{key:"mode",value:function(){return this._mode}},{key:"setMode",value:function(t){Object.values(Xt).indexOf>-1&&(this._mode=t)}},{key:"setData",value:function(t){return t!==this._data&&(this._data=t,!0)}},{key:"data",value:function(){return this._data}},{key:"points",value:function(){return this._points}},{key:"isDrawing",value:function(){return-1!==this._drawStep}},{key:"isStart",value:function(){return 1===this._drawStep}},{key:"checkEventCoordinateOn",value:function(t){for(var e=this._styles||this._chartStore.styleOptions().shape,i=this._coordinates.length-1;i>-1;i--)if(kt(this._coordinates[i],e.point.radius,t))return{id:this._id,element:Ft,elementIndex:i,instance:this};if(this._shapeDataSources){var a,n=m(this._shapeDataSources);try{for(n.s();!(a=n.n()).done;){var s=a.value,o=s.key,r=s.type,h=s.dataSource,c=void 0===h?[]:h;if(s.isCheck)for(var l=0;c.length>l;l++){if(this.checkEventCoordinateOnShape({key:o,type:r,dataSource:c[l],eventCoordinate:t}))return{id:this._id,element:Ot,elementIndex:l,instance:this}}}}catch(t){n.e(t)}finally{n.f()}}}},{key:"_performValue",value:function(t,e,i){var a=this._yAxis.convertFromPixel(t);if(this._mode===Xt.NORMAL||"candle_pane"!==i)return a;var n=this._chartStore.timeScaleStore().getDataByDataIndex(e);if(!n)return a;if(a>n.high){if(this._mode===Xt.WEAK_MAGNET){var s=this._yAxis.convertToPixel(n.high);return this._yAxis.convertFromPixel(s-8)>a?n.high:a}return n.high}if(n.low>a){if(this._mode===Xt.WEAK_MAGNET){var o=this._yAxis.convertToPixel(n.low);return a>this._yAxis.convertFromPixel(o-8)?n.low:a}return n.low}var r=Math.max(n.open,n.close);if(a>r)return n.high-a>a-r?r:n.high;var h=Math.min(n.open,n.close);return h>a?h-a>a-n.low?n.low:h:a-h>r-a?r:h}},{key:"mouseMoveForDrawing",value:function(t,e){var i=this._xAxis.convertFromPixel(t.x),a=this._chartStore.timeScaleStore().dataIndexToTimestamp(i),n=this._performValue(t.y,i,e.paneId);this._points[this._drawStep-1]={timestamp:a,value:n,dataIndex:i},this.performEventMoveForDrawing({step:this._drawStep,mode:this._mode,points:this._points,movePoint:{timestamp:a,value:n,dataIndex:i},xAxis:this._xAxis,yAxis:this._yAxis}),this.onDrawing({id:this._id,step:this._drawStep,points:this._points})}},{key:"mouseLeftButtonDownForDrawing",value:function(){this._drawStep===this._totalStep-1?(this._drawStep=-1,this._chartStore.shapeStore().progressInstanceComplete(),this.onDrawEnd({id:this._id,points:this._points})):this._drawStep++}},{key:"mousePressedPointMove",value:function(t,e){var i=this._chartStore.shapeStore().mouseOperate(),a=i.click.elementIndex;if(!this._lock&&i.click.id===this._id&&i.click.element===Ft&&-1!==a){var n=this._xAxis.convertFromPixel(t.x),s=this._chartStore.timeScaleStore().dataIndexToTimestamp(n),o=this._performValue(t.y,n,e.paneId);this._points[a].timestamp=s,this._points[a].dataIndex=n,this._points[a].value=o,this.performEventPressedMove({points:this._points,mode:this._mode,pressPointIndex:a,pressPoint:{dataIndex:n,timestamp:s,value:o},xAxis:this._xAxis,yAxis:this._yAxis}),this.onPressedMove({id:this._id,element:Ft,points:this._points,event:e})}}},{key:"startPressedOtherMove",value:function(t){var e=this._xAxis.convertFromPixel(t.x),i=this._yAxis.convertFromPixel(t.y);this._prevPressPoint={dataIndex:e,value:i},this._prevPoints=x(this._points)}},{key:"mousePressedOtherMove",value:function(t,e){var i=this;if(this._prevPressPoint){var a=this._xAxis.convertFromPixel(t.x),n=this._yAxis.convertFromPixel(t.y),s=a-this._prevPressPoint.dataIndex,o=n-this._prevPressPoint.value;this._points=this._prevPoints.map((function(t){b(t.dataIndex)||(t.dataIndex=i._chartStore.timeScaleStore().timestampToDataIndex(t.timestamp));var e=t.dataIndex+s;return{dataIndex:e,value:t.value+o,timestamp:i._chartStore.timeScaleStore().dataIndexToTimestamp(e)}})),this.onPressedMove({id:this._id,element:Ot,points:this._points,event:e})}}},{key:"onDrawStart",value:function(t){}},{key:"onDrawing",value:function(t){}},{key:"onDrawEnd",value:function(t){}},{key:"onPressedMove",value:function(t){}},{key:"onRemove",value:function(t){}},{key:"checkEventCoordinateOnShape",value:function(t){}},{key:"createShapeDataSource",value:function(t){}},{key:"performEventMoveForDrawing",value:function(t){}},{key:"performEventPressedMove",value:function(t){}}]),i}(xt),Zt=1,Ut=2,Kt=3,qt=function(){function t(e){s(this,t),this._chartStore=e,this._templates=this._createTemplates(),this._mouseOperate={click:{id:"",element:zt,elementIndex:-1},hover:{id:"",element:zt,elementIndex:-1}},this._progressInstance=null,this._pressedInstance=null,this._instances=new Map}return r(t,[{key:"_createTemplates",value:function(){var t={},i=e.shapeExtensions;for(var a in i){var n=this._createTemplateClass(i[a]);n&&(t[a]=n)}return t}},{key:"_createTemplateClass",value:function(t){var e=t.name,i=t.totalStep,a=t.checkEventCoordinateOnShape,n=t.createShapeDataSource,o=t.performEventPressedMove,h=t.performEventMoveForDrawing,l=t.drawExtend;if(!(e&&w(i)&&S(a)&&S(n)))return null;var u=function(t){c(n,t);var a=_(n);function n(t){var o=t.id,r=t.chartStore,h=t.xAxis,c=t.yAxis,l=t.points,u=t.styles,d=t.lock,_=t.data;return s(this,n),a.call(this,{id:o,name:e,totalStep:i,chartStore:r,xAxis:h,yAxis:c,points:l,styles:u,lock:d,data:_})}return r(n)}(Gt);return u.prototype.checkEventCoordinateOnShape=a,u.prototype.createShapeDataSource=n,S(o)&&(u.prototype.performEventPressedMove=o),S(h)&&(u.prototype.performEventMoveForDrawing=h),S(l)&&(u.prototype.drawExtend=l),u}},{key:"addTemplate",value:function(t){var e=this;t.forEach((function(t){var i=e._createTemplateClass(t);i&&(e._templates[t.name]=i)}))}},{key:"getTemplate",value:function(t){return this._templates[t]}},{key:"getInstance",value:function(t){var e,i=m(this._instances);try{for(i.s();!(e=i.n()).done;){var a=(e.value[1]||[]).find((function(e){return e.id()===t}));if(a)return a}}catch(t){i.e(t)}finally{i.f()}return null}},{key:"hasInstance",value:function(t){return!!this.getInstance(t)}},{key:"addInstance",value:function(t,e){t.isDrawing()?this._progressInstance={paneId:e,instance:t,fixed:b(e)}:(this._instances.has(e)||this._instances.set(e,[]),this._instances.get(e).push(t)),this._chartStore.invalidate(Zt)}},{key:"progressInstance",value:function(){return this._progressInstance||{}}},{key:"progressInstanceComplete",value:function(){var t=this.progressInstance(),e=t.instance,i=t.paneId;e&&!e.isDrawing()&&(this._instances.has(i)||this._instances.set(i,[]),this._instances.get(i).push(e),this._progressInstance=null)}},{key:"updateProgressInstance",value:function(t,e){var i=this.progressInstance(),a=i.instance;a&&!i.fixed&&(a.setYAxis(t),this._progressInstance.paneId=e)}},{key:"pressedInstance",value:function(){return this._pressedInstance||{}}},{key:"updatePressedInstance",value:function(t,e,i){this._pressedInstance=t?{instance:t,paneId:e,element:i}:null}},{key:"instances",value:function(t){return this._instances.get(t)||[]}},{key:"setInstanceOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.id,i=t.styles,a=t.lock,n=t.mode,s=t.data,o=this._chartStore.styleOptions().shape,r=!1;if(b(e)){var h=this.getInstance(e);h&&(h.setLock(a),h.setMode(n),(h.setStyles(i,o)||h.setData(s))&&(r=!0))}else this._instances.forEach((function(t){t.forEach((function(t){t.setLock(a),t.setMode(n),(t.setStyles(i,o)||t.setData(s))&&(r=!0)}))}));r&&this._chartStore.invalidate(Zt)}},{key:"getInstanceInfo",value:function(t){var e=function(t){return{name:t.name(),id:t.id(),totalStep:t.totalStep(),lock:t.lock(),mode:t.mode(),points:t.points(),styles:t.styles(),data:t.data()}},i=this.progressInstance();if(!b(t)){var a={};return this._instances.forEach((function(t,n){a[n]=t.map((function(t){return e(t)})),i.paneId===n&&i.instance&&a[n].push(e(i.instance))})),a}if(i.instance&&i.instance.id()===t)return e(i.instance);var n=this.getInstance(t);return n?e(n):null}},{key:"removeInstance",value:function(t){var e=!1,i=this.progressInstance().instance;if(!i||b(t)&&i.id()!==t||(i.onRemove({id:i.id()}),this._progressInstance=null,e=!0),b(t)){var a,n=m(this._instances);try{for(n.s();!(a=n.n()).done;){var s=a.value,o=s[1]||[],r=o.findIndex((function(e){return e.id()===t}));if(r>-1){o[r].onRemove({id:o[r].id()}),o.splice(r,1),0===o.length&&this._instances.delete(s[0]),e=!0;break}}}catch(t){n.e(t)}finally{n.f()}}else this._instances.forEach((function(t){t.length>0&&t.forEach((function(t){t.onRemove({id:t.id()})}))})),this._instances.clear(),e=!0;e&&this._chartStore.invalidate(Zt)}},{key:"mouseOperate",value:function(){return this._mouseOperate}},{key:"setMouseOperate",value:function(t){var e=this._mouseOperate,i=e.hover,n=e.click;!t.hover||i.id===t.hover.id&&i.element===t.hover.element&&i.elementIndex===t.hover.elementIndex||(this._mouseOperate.hover=a({},t.hover)),!t.click||n.id===t.click.id&&n.element===t.click.element&&n.elementIndex===t.click.elementIndex||(this._mouseOperate.click=a({},t.click))}},{key:"isEmpty",value:function(){return 0===this._instances.size&&!this.progressInstance().instance}},{key:"isDrawing",value:function(){var t=this.progressInstance().instance;return t&&t.isDrawing()}},{key:"isPressed",value:function(){return!!this.pressedInstance().instance}}]),t}(),$t=function(){function t(e){s(this,t),this._chartStore=e,this._annotations=new Map,this._visibleAnnotations=new Map,this._mouseOperate={id:""}}return r(t,[{key:"mouseOperate",value:function(){return this._mouseOperate}},{key:"setMouseOperate",value:function(t){t&&this._mouseOperate.id!==t.id&&(this._mouseOperate=a({},t))}},{key:"createVisibleAnnotations",value:function(){var t=this;this._visibleAnnotations.clear(),this._annotations.size>0&&this._chartStore.visibleDataList().forEach((function(e){var i=e.data,a=e.x;t._annotations.forEach((function(e,n){if(e.size>0){var s=e.get(i.timestamp)||[];if(s.length>0){var o,r=m(s);try{for(r.s();!(o=r.n()).done;){var h=o.value;h.createSymbolCoordinate(a),t._visibleAnnotations.has(n)?t._visibleAnnotations.get(n).push(h):t._visibleAnnotations.set(n,[h])}}catch(t){r.e(t)}finally{r.f()}}}}))}))}},{key:"add",value:function(t,e){var i=this;this._annotations.has(e)||this._annotations.set(e,new Map),t.forEach((function(t){var a=i._annotations.get(e);a.has(t.id())?a.get(t.id()).push(t):a.set(t.id(),[t])})),this.createVisibleAnnotations(),this._chartStore.invalidate(Zt)}},{key:"get",value:function(t){return this._visibleAnnotations.get(t)}},{key:"remove",value:function(t,e){var i=!1;if(b(t)){if(this._annotations.has(t))if(b(e)){var a=this._annotations.get(t);[].concat(e).forEach((function(t){var e=t.timestamp;a.has(e)&&(i=!0,a.delete(e))})),0===a.size&&this._annotations.delete(t),i&&this.createVisibleAnnotations()}else i=!0,this._annotations.delete(t),this._visibleAnnotations.delete(t)}else i=!0,this._annotations.clear(),this._visibleAnnotations.clear();i&&this._chartStore.invalidate(Zt)}},{key:"isEmpty",value:function(){return 0===this._visibleAnnotations.size}}]),t}(),Jt=function(){function t(e){s(this,t),this._chartStore=e,this._tags=new Map}return r(t,[{key:"_getById",value:function(t,e){var i=this.get(e);return i?i.get(t):null}},{key:"has",value:function(t,e){return!!this._getById(t,e)}},{key:"update",value:function(t,e,i){var a=this._getById(t,e);return!!a&&a.update(i)}},{key:"get",value:function(t){return this._tags.get(t)}},{key:"add",value:function(t,e){this._tags.has(e)||this._tags.set(e,new Map);var i=this._tags.get(e);t.forEach((function(t){i.set(t.id(),t)})),this._chartStore.invalidate(Zt)}},{key:"remove",value:function(t,e){var i=!1;if(b(t)){if(this._tags.has(t))if(b(e)){var a=this._tags.get(t);[].concat(e).forEach((function(t){a.has(t)&&(i=!0,a.delete(t))})),0===a.size&&this._tags.delete(t)}else i=!0,this._tags.delete(t)}else i=!0,this._tags.clear();i&&this._chartStore.invalidate(Zt)}}]),t}(),Qt=function(){function t(e){s(this,t),this._chartStore=e,this._crosshair={}}return r(t,[{key:"set",value:function(t,e){var i,n,s=this._chartStore.dataList(),o=t||{},r=s[n=b(o.x)?0>(i=this._chartStore.timeScaleStore().coordinateToDataIndex(o.x))?0:i>s.length-1?s.length-1:i:i=s.length-1],h=this._chartStore.timeScaleStore().dataIndexToCoordinate(i),c=this._crosshair.x,l=this._crosshair.y,u=this._crosshair.paneId;this._crosshair=a(a({},o),{},{realX:h,kLineData:r,realDataIndex:i,dataIndex:n}),r&&this._chartStore.crosshairChange({crosshair:o,realDataIndex:i,dataIndex:n,kLineData:r,x:o.x,y:o.y}),c===o.x&&l===o.y&&u===o.paneId||e||this._chartStore.invalidate(Zt)}},{key:"recalculate",value:function(t){this.set(this._crosshair,t)}},{key:"get",value:function(){return this._crosshair}}]),t}(),te=function(){function t(){s(this,t),this._observers=[]}return r(t,[{key:"subscribe",value:function(t){0>this._observers.indexOf(t)&&this._observers.push(t)}},{key:"unsubscribe",value:function(t){var e=this._observers.indexOf(t);e>-1?this._observers.splice(e,1):this._observers=[]}},{key:"execute",value:function(t){this._observers.forEach((function(e){e(t)}))}},{key:"hasObservers",value:function(){return this._observers.length>0}}]),t}(),ee=function(){function t(){s(this,t),this._delegates=new Map}return r(t,[{key:"execute",value:function(t,e){this.has(t)&&this._delegates.get(t).execute(e)}},{key:"has",value:function(t){return this._delegates.has(t)&&this._delegates.get(t).hasObservers()}},{key:"subscribe",value:function(t,e){return!!ct(t)&&(this._delegates.has(t)||this._delegates.set(t,new te),this._delegates.get(t).subscribe(e),!0)}},{key:"unsubscribe",value:function(t,e){if(ct(t)){var i=this._delegates.get(t);return i.unsubscribe(e),i.hasObservers()||this._delegates.delete(t),!0}return!1}}]),t}(),ie=function(){function t(e,i){s(this,t),this._handler=i,this._styleOptions=x(tt),y(this._styleOptions,e),this._pricePrecision=2,this._volumePrecision=0,this._dataList=[],this._visibleDataList=[],this._dragPaneFlag=!1,this._timeScaleStore=new lt(this),this._technicalIndicatorStore=new mt(this),this._shapeStore=new qt(this),this._annotationStore=new $t(this),this._tagStore=new Jt(this),this._crosshairStore=new Qt(this),this._actionStore=new ee}return r(t,[{key:"adjustVisibleDataList",value:function(){this._visibleDataList=[];for(var t=this._timeScaleStore.from(),e=this._timeScaleStore.to(),i=t;e>i;i++){var a=this._dataList[i],n=this._timeScaleStore.dataIndexToCoordinate(i);this._visibleDataList.push({index:i,x:n,data:a})}this._annotationStore.createVisibleAnnotations()}},{key:"styleOptions",value:function(){return this._styleOptions}},{key:"applyStyleOptions",value:function(t){y(this._styleOptions,t)}},{key:"pricePrecision",value:function(){return this._pricePrecision}},{key:"volumePrecision",value:function(){return this._volumePrecision}},{key:"setPriceVolumePrecision",value:function(t,e){this._pricePrecision=t,this._volumePrecision=e,this._technicalIndicatorStore.setSeriesPrecision(t,e)}},{key:"dataList",value:function(){return this._dataList}},{key:"visibleDataList",value:function(){return this._visibleDataList}},{key:"addData",value:function(t,e,i){if(k(t)){if(g(t)){this._timeScaleStore.setLoading(!1),this._timeScaleStore.setMore(!E(i)||i);var a=0===this._dataList.length;this._dataList=t.concat(this._dataList),a&&this._timeScaleStore.resetOffsetRightSpace(),this._timeScaleStore.adjustFromTo()}else{if(e<this._dataList.length)this._dataList[e]=t,this.adjustVisibleDataList();else{this._dataList.push(t);var n=this._timeScaleStore.offsetRightBarCount();0>n&&this._timeScaleStore.setOffsetRightBarCount(--n),this._timeScaleStore.adjustFromTo()}}this._crosshairStore.recalculate(!0)}}},{key:"clearDataList",value:function(){this._dataList=[],this._visibleDataList=[],this._timeScaleStore.clear()}},{key:"timeScaleStore",value:function(){return this._timeScaleStore}},{key:"technicalIndicatorStore",value:function(){return this._technicalIndicatorStore}},{key:"shapeStore",value:function(){return this._shapeStore}},{key:"annotationStore",value:function(){return this._annotationStore}},{key:"tagStore",value:function(){return this._tagStore}},{key:"crosshairStore",value:function(){return this._crosshairStore}},{key:"actionStore",value:function(){return this._actionStore}},{key:"invalidate",value:function(t){this._handler.invalidate(t)}},{key:"crosshairChange",value:function(t){this._handler.crosshair(t)}},{key:"dragPaneFlag",value:function(){return this._dragPaneFlag}},{key:"setDragPaneFlag",value:function(t){this._dragPaneFlag=t}}]),t}();function ae(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=document.createElement(t);for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(i.style[a]=e[a]);return i}var ne=function(){function t(e){s(this,t),this._height=-1,this._container=e.container,this._chartStore=e.chartStore,this._initBefore(e),this._initElement(),this._mainWidget=this._createMainWidget(this._element,e),this._yAxisWidget=this._createYAxisWidget(this._element,e)}return r(t,[{key:"_initBefore",value:function(t){}},{key:"_initElement",value:function(){this._element=ae("div",{width:"100%",margin:"0",padding:"0",position:"relative",overflow:"hidden",boxSizing:"border-box"});var t=this._container.lastChild;t?this._container.insertBefore(this._element,t):this._container.appendChild(this._element)}},{key:"_createMainWidget",value:function(t,e){}},{key:"_createYAxisWidget",value:function(t,e){}},{key:"width",value:function(){return this._element.offsetWidth}},{key:"setWidth",value:function(t,e){this._mainWidget.setWidth(t),this._yAxisWidget&&this._yAxisWidget.setWidth(e)}},{key:"height",value:function(){return this._height}},{key:"setHeight",value:function(t){this._height=t,this._mainWidget.setHeight(t),this._yAxisWidget&&this._yAxisWidget.setHeight(t)}},{key:"setOffsetLeft",value:function(t,e){this._mainWidget.setOffsetLeft(t),this._yAxisWidget&&this._yAxisWidget.setOffsetLeft(e)}},{key:"layout",value:function(){this._element.offsetHeight!==this._height&&(this._element.style.height="".concat(this._height,"px")),this._mainWidget.layout(),this._yAxisWidget&&this._yAxisWidget.layout()}},{key:"invalidate",value:function(t){this._yAxisWidget&&this._yAxisWidget.invalidate(t),this._mainWidget.invalidate(t)}},{key:"createHtml",value:function(t){var e=t.id,i=t.content,a=t.style;return"yAxis"===t.position?this._yAxisWidget&&this._yAxisWidget.createHtml({id:e,content:i,style:a}):this._mainWidget.createHtml({id:e,content:i,style:a})}},{key:"removeHtml",value:function(t){this._yAxisWidget&&this._yAxisWidget.removeHtml(t),this._mainWidget.removeHtml(t)}},{key:"getImage",value:function(t){var e=this._element.offsetWidth,i=this._element.offsetHeight,a=ae("canvas",{width:"".concat(e,"px"),height:"".concat(i,"px"),boxSizing:"border-box"}),n=a.getContext("2d"),s=Tt(a);a.width=e*s,a.height=i*s,n.scale(s,s);var o=this._mainWidget.getElement(),r=o.offsetWidth,h=o.offsetHeight,c=parseInt(o.style.left,10);if(n.drawImage(this._mainWidget.getImage(t),c,0,r,h),this._yAxisWidget){var l=this._yAxisWidget.getElement(),u=l.offsetWidth,d=l.offsetHeight,_=parseInt(l.style.left,10);n.drawImage(this._yAxisWidget.getImage(t),_,0,u,d)}return a}},{key:"destroy",value:function(){this._container.removeChild(this._element)}}]),t}(),se=function(){function t(e){s(this,t),this._width=0,this._height=0,this._initElement(e.container),this._mainView=this._createMainView(this._element,e),this._overlayView=this._createOverlayView(this._element,e),this._htmlBaseId=0,this._htmls=new Map}return r(t,[{key:"_initElement",value:function(t){this._element=ae("div",{margin:"0",padding:"0",position:"absolute",top:"0",overflow:"hidden",boxSizing:"border-box"}),t.appendChild(this._element)}},{key:"_createMainView",value:function(t,e){}},{key:"_createOverlayView",value:function(t,e){}},{key:"createHtml",value:function(t){var e=t.id,i=t.content,n=t.style,s=ae("div",a({boxSizing:"border-box",position:"absolute",zIndex:12},void 0===n?{}:n));if(P(i)){var o=i.replace(/(^\s*)|(\s*$)/g,"");s.innerHTML=o}else s.appendChild(i);var r=e||"html_".concat(++this._htmlBaseId);return this._htmls.has(r)?this._element.replaceChild(s,this._htmls.get(r)):this._element.appendChild(s),this._htmls.set(r,s),r}},{key:"removeHtml",value:function(t){var e=this;t?[].concat(t).forEach((function(t){var i=e._htmls.get(t);i&&(e._element.removeChild(i),e._htmls.delete(t))})):(this._htmls.forEach((function(t){e._element.removeChild(t)})),this._htmls.clear())}},{key:"getElement",value:function(){return this._element}},{key:"setWidth",value:function(t){this._width=t,this._mainView.setWidth(t),this._overlayView.setWidth(t)}},{key:"setHeight",value:function(t){this._height=t,this._mainView.setHeight(t),this._overlayView.setHeight(t)}},{key:"setOffsetLeft",value:function(t){this._element.style.left="".concat(t,"px")}},{key:"layout",value:function(){this._element.offsetWidth!==this._width&&(this._element.style.width="".concat(this._width,"px")),this._element.offsetHeight!==this._height&&(this._element.style.height="".concat(this._height,"px")),this._mainView.layout(),this._overlayView.layout()}},{key:"invalidate",value:function(t){switch(t){case Zt:this._overlayView.flush();break;case Ut:case Kt:this._mainView.flush(),this._overlayView.flush()}}},{key:"getImage",value:function(t){var e=ae("canvas",{width:"".concat(this._width,"px"),height:"".concat(this._height,"px"),boxSizing:"border-box"}),i=e.getContext("2d"),a=Tt(e);return e.width=this._width*a,e.height=this._height*a,i.scale(a,a),i.drawImage(this._mainView.getImage(),0,0,this._width,this._height),t&&this._overlayView&&i.drawImage(this._overlayView.getImage(),0,0,this._width,this._height),e}}]),t}();function oe(t){return window.requestAnimationFrame?window.requestAnimationFrame(t):window.setTimeout(t,20)}var re=function(){function t(e,i){s(this,t),this._chartStore=i,this._initCanvas(e)}return r(t,[{key:"_initCanvas",value:function(t){this._canvas=ae("canvas",{position:"absolute",top:"0",left:"0",zIndex:"2",boxSizing:"border-box"}),this._ctx=this._canvas.getContext("2d"),t.appendChild(this._canvas)}},{key:"_redraw",value:function(t){this._ctx.clearRect(0,0,this._canvas.offsetWidth,this._canvas.offsetHeight),t&&t(),this._draw()}},{key:"_draw",value:function(){}},{key:"setWidth",value:function(t){this._width=t}},{key:"setHeight",value:function(t){this._height=t}},{key:"layout",value:function(){var t=this;this._height!==this._canvas.offsetHeight||this._width!==this._canvas.offsetWidth?this._redraw((function(){var e=Tt(t._canvas);t._canvas.style.width="".concat(t._width,"px"),t._canvas.style.height="".concat(t._height,"px"),t._canvas.width=Math.floor(t._width*e),t._canvas.height=Math.floor(t._height*e),t._ctx.scale(e,e)})):this.flush()}},{key:"flush",value:function(){var t,e=this;this.requestAnimationId&&(t=this.requestAnimationId,window.cancelAnimationFrame||clearTimeout(t),window.cancelAnimationFrame(t),this.requestAnimationId=null),this.requestAnimationId=oe((function(){e._redraw()}))}},{key:"getImage",value:function(){return this._canvas}}]),t}(),he=function(t){c(i,t);var e=_(i);function i(t,a,n,o,r){var h;return s(this,i),(h=e.call(this,t,a))._xAxis=n,h._yAxis=o,h._paneId=r,h}return r(i,[{key:"_draw",value:function(){this._ctx.globalCompositeOperation="destination-over",this._drawContent()}},{key:"_drawContent",value:function(){this._drawTechs(),this._drawGrid()}},{key:"_drawGrid",value:function(){var t=this,e=this._chartStore.styleOptions().grid;if(e.show){var i=e.horizontal;this._ctx.save(),i.show&&(this._ctx.strokeStyle=i.color,this._ctx.lineWidth=i.size,this._ctx.setLineDash(i.style===T?i.dashValue:[]),this._yAxis.ticks().forEach((function(e){Pt(t._ctx,e.y,0,t._width)})));var a=e.vertical;a.show&&(this._ctx.strokeStyle=a.color,this._ctx.lineWidth=a.size,this._ctx.setLineDash(a.style===T?a.dashValue:[]),this._xAxis.ticks().forEach((function(e){Ct(t._ctx,e.x,0,t._height)}))),this._ctx.restore()}}},{key:"_drawTechs",value:function(){var t=this;this._ctx.globalCompositeOperation="source-over";var e=this._chartStore.styleOptions().technicalIndicator;this._chartStore.technicalIndicatorStore().instances(this._paneId).forEach((function(i){var a=i.plots,n=[],s=t._chartStore.dataList(),o=i.result,r=i.styles||e;i.render&&(t._ctx.save(),i.render({ctx:t._ctx,dataSource:{from:t._chartStore.timeScaleStore().from(),to:t._chartStore.timeScaleStore().to(),kLineDataList:t._chartStore.dataList(),technicalIndicatorDataList:o},viewport:{width:t._width,height:t._height,dataSpace:t._chartStore.timeScaleStore().dataSpace(),barSpace:t._chartStore.timeScaleStore().barSpace()},styles:r,xAxis:t._xAxis,yAxis:t._yAxis}),t._ctx.restore());var h=e.line.colors||[],c=h.length,l=t._yAxis.isCandleYAxis();t._ctx.lineWidth=1,t._drawGraphics((function(e,u,d,_,v){var f=o[u]||{},p=0;i.shouldOhlc&&!l&&t._drawCandleBar(e,_,v,u,d,r.bar,V),a.forEach((function(i){var a=f[i.key],l=t._yAxis.convertToPixel(a);switch(i.type){case _t:if(b(a)){var d=ft(s,o,u,i,r,{color:r.circle.noChangeColor,isStroke:!0});t._drawCircle({x:e,y:l,radius:_,color:d.color,isStroke:d.isStroke})}break;case dt:if(b(a)){var v;v=b(i.baseValue)?i.baseValue:t._yAxis.min();var m=t._yAxis.convertToPixel(v),y=Math.abs(m-l),x={x:e-_,width:2*_,height:Math.max(1,y)};x.y=l>m?m:1>y?m-1:l;var g=ft(s,o,u,i,r,{color:r.bar.noChangeColor});x.color=g.color,x.isStroke=g.isStroke,t._drawBar(x)}break;case ut:var S=null;if(b(a)&&(S={x:e,y:l}),n[p])n[p].coordinates.push(S);else{var k=ft(s,o,u,i,r,{color:h[p%c]});n[p]={color:k.color,coordinates:[S]}}p++}}))}),(function(){t._drawLines(n,r)}))})),this._ctx.globalCompositeOperation="destination-over"}},{key:"_drawGraphics",value:function(t,e){var i=this._chartStore.visibleDataList(),a=this._chartStore.timeScaleStore().barSpace(),n=this._chartStore.timeScaleStore().halfBarSpace();i.forEach((function(e,i){t(e.x,e.index,e.data,n,a,i)})),e&&e()}},{key:"_drawLines",value:function(t,e){var i=this;this._ctx.lineWidth=e.line.size,t.forEach((function(t){i._ctx.strokeStyle=t.color,At(i._ctx,t.coordinates)}))}},{key:"_drawBar",value:function(t){t.isStroke?(this._ctx.strokeStyle=t.color,this._ctx.strokeRect(t.x+.5,t.y,t.width-1,t.height)):(this._ctx.fillStyle=t.color,this._ctx.fillRect(t.x,t.y,t.width,t.height))}},{key:"_drawCircle",value:function(t){this._ctx.strokeStyle=t.color,this._ctx.fillStyle=t.color,this._ctx.beginPath(),this._ctx.arc(t.x,t.y,t.radius,2*Math.PI,0,!0),t.isStroke?this._ctx.stroke():this._ctx.fill(),this._ctx.closePath()}},{key:"_drawCandleBar",value:function(t,e,i,a,n,s,o){var r=n.open,h=n.close,c=n.high,l=n.low;h>r?(this._ctx.strokeStyle=s.upColor,this._ctx.fillStyle=s.upColor):r>h?(this._ctx.strokeStyle=s.downColor,this._ctx.fillStyle=s.downColor):(this._ctx.strokeStyle=s.noChangeColor,this._ctx.fillStyle=s.noChangeColor);var u=this._yAxis.convertToPixel(r),d=this._yAxis.convertToPixel(h),_=this._yAxis.convertToPixel(c),v=this._yAxis.convertToPixel(l),f=Math.min(u,d),p=Math.max(u,d);this._ctx.fillRect(t-.5,_,1,f-_),this._ctx.fillRect(t-.5,p,1,v-p);var m=Math.max(1,p-f);switch(o){case z:this._ctx.fillRect(t-e,f,i,m);break;case R:this._ctx.strokeRect(t-e+.5,f,i-1,m);break;case B:h>r?this._ctx.strokeRect(t-e+.5,f,i-1,m):this._ctx.fillRect(t-e,f,i,m);break;case H:h>r?this._ctx.fillRect(t-e,f,i,m):this._ctx.strokeRect(t-e+.5,f,i-1,m);break;default:this._ctx.fillRect(t-.5,_,1,v-_),this._ctx.fillRect(t-e,u-.5,e,1),this._ctx.fillRect(t,d-.5,e,1)}}}]),i}(re);function ce(t,e,i,a,n){t.fillStyle=e,t.fillText(n,i,a)}var le=function(t){c(i,t);var e=_(i);function i(t,a,n,o,r){var h;return s(this,i),(h=e.call(this,t,a))._xAxis=n,h._yAxis=o,h._paneId=r,h}return r(i,[{key:"_draw",value:function(){this._ctx.textBaseline="alphabetic",this._drawTag(),this._drawShape(),this._drawAnnotation();var t=this._chartStore.crosshairStore().get();if(t.kLineData){var e=this._chartStore.styleOptions().crosshair;t.paneId===this._paneId&&this._drawCrosshairLine(e,"horizontal",t.y,0,this._width,Pt),t.paneId&&this._drawCrosshairLine(e,"vertical",t.realX,0,this._height,Ct),this._drawTooltip(t,this._chartStore.technicalIndicatorStore().instances(this._paneId))}}},{key:"_drawAnnotation",value:function(){var t=this,e=this._chartStore.annotationStore().get(this._paneId);e&&e.forEach((function(e){e.draw(t._ctx)}))}},{key:"_drawTag",value:function(){var t=this,e=this._chartStore.tagStore().get(this._paneId);e&&e.forEach((function(e){e.drawMarkLine(t._ctx)}))}},{key:"_drawShape",value:function(){var t=this;this._chartStore.shapeStore().instances(this._paneId).forEach((function(e){e.draw(t._ctx)}));var e=this._chartStore.shapeStore().progressInstance();e.paneId===this._paneId&&e.instance.draw(this._ctx)}},{key:"_drawTooltip",value:function(t,e){var i=this._chartStore.styleOptions().technicalIndicator;this._drawBatchTechToolTip(t,e,i,0,this._shouldDrawTooltip(t,i.tooltip))}},{key:"_drawCrosshairLine",value:function(t,e,i,a,n,s){var o=t[e],r=o.line;t.show&&o.show&&r.show&&(this._ctx.save(),this._ctx.lineWidth=r.size,this._ctx.strokeStyle=r.color,r.style===T&&this._ctx.setLineDash(r.dashValue),s(this._ctx,i,a,n),this._ctx.restore())}},{key:"_drawBatchTechToolTip",value:function(t,e,i){var a=this,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4?arguments[4]:void 0;if(s){var o=i.tooltip,r=n;e.forEach((function(e){a._drawTechTooltip(t,e,i,r),r+=o.text.marginTop+o.text.size+o.text.marginBottom}))}}},{key:"_drawTechTooltip",value:function(t,e,i){var a=this,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=i.tooltip,o=s.text,r=o.marginLeft,h=o.marginRight,c=o.size,l=o.color,u=0,d=o.marginTop+n,_=this._getTechTooltipData(t,e,i);if(this._ctx.textBaseline="top",this._ctx.font=Mt(c,o.weight,o.family),s.showName){var v=_.name,f=It(this._ctx,v);ce(this._ctx,l,u+=r,d,v),u+=f,s.showParams||(u+=h)}if(s.showParams){var p=_.calcParamText,m=It(this._ctx,p);s.showName||(u+=r),ce(this._ctx,l,u,d,p),u+=m+h}_.values.forEach((function(t){u+=r;var e="".concat(t.title).concat(t.value),i=It(a._ctx,e);ce(a._ctx,t.color,u,d,e),u+=i+h}))}},{key:"_shouldDrawTooltip",value:function(t,e){var i=e.showRule;return i===W||i===N&&!!t.paneId}},{key:"_getTechTooltipData",value:function(t,e,i){var a=e.styles||i,n=e.result,s=n[t.dataIndex],o=this._chartStore.dataList(),r=e.calcParams,h=e.plots,c=e.precision,l=e.shouldFormatBigNumber,u="",d="";if(h.length>0&&(u=e.shortName||e.name),r.length>0){var _=r.map((function(t){return k(t)?t.value:t}));d="(".concat(_.join(","),")")}var v=a.line.colors||[],f=v.length,p=0,m=[];return h.forEach((function(e){var r={};switch(e.type){case _t:r={color:a.circle.noChangeColor};break;case dt:r={color:a.bar.noChangeColor};break;case ut:r={color:v[p%f]||i.tooltip.text.color},p++}var h=ft(o,n,t.dataIndex,e,a,r),u={};if(b(e.title)){var d=(s||{})[e.key];b(d)&&(d=at(d,c),l&&(d=nt(d))),u.title=e.title,u.value=d||i.tooltip.defaultValue,u.color=h.color}m.push(u)})),{values:m,name:u,calcParamText:d}}}]),i}(re),ue=function(t){c(i,t);var e=_(i);function i(){return s(this,i),e.apply(this,arguments)}return r(i,[{key:"_createMainView",value:function(t,e){return new he(t,e.chartStore,e.xAxis,e.yAxis,e.paneId)}},{key:"_createOverlayView",value:function(t,e){return new le(t,e.chartStore,e.xAxis,e.yAxis,e.paneId)}}]),i}(se);function de(t,e,i,a,n,s,o,r,h){ve(t,e,n,s,o,r,h),_e(t,i,a,n,s,o,r,h)}function _e(t,e,i,a,n,s,o,r){t.lineWidth=i,t.strokeStyle=e,fe(t,a,n,s,o,r),t.stroke()}function ve(t,e,i,a,n,s,o){t.fillStyle=e,fe(t,i,a,n,s,o),t.fill()}function fe(t,e,i,a,n,s){t.beginPath(),t.moveTo(e+s,i),t.arcTo(e+a,i,e+a,i+n,s),t.arcTo(e+a,i+n,e,i+n,s),t.arcTo(e,i+n,e,i,s),t.arcTo(e,i,e+a,i,s),t.closePath()}var pe=function(t){c(i,t);var e=_(i);function i(t,a,n,o){var r;return s(this,i),(r=e.call(this,t,a))._yAxis=n,r._paneId=o,r}return r(i,[{key:"_draw",value:function(){var t=this._chartStore.styleOptions().yAxis;t.show&&(this._drawAxisLine(t),this._drawTickLines(t),this._drawTickLabels(t),this._drawTechLastValue(),this._drawLastPriceLabel())}},{key:"_drawAxisLine",value:function(t){var e,i=t.axisLine;i.show&&(this._ctx.strokeStyle=i.color,this._ctx.lineWidth=i.size,e=this._yAxis.isFromYAxisZero()?0:this._width-1,Ct(this._ctx,e,0,this._height))}},{key:"_drawTickLines",value:function(t){var e=this,i=t.tickLine;if(i.show){this._ctx.lineWidth=i.size,this._ctx.strokeStyle=i.color;var a,n,s=i.length;this._yAxis.isFromYAxisZero()?(a=0,t.axisLine.show&&(a+=t.axisLine.size),n=a+s):(a=this._width,t.axisLine.show&&(a-=t.axisLine.size),n=a-s),this._yAxis.ticks().forEach((function(t){Pt(e._ctx,t.y,a,n)}))}}},{key:"_drawTickLabels",value:function(t){var e=this,i=t.tickText;if(i.show){var a,n=t.tickLine,s=n.show,o=n.length;this._yAxis.isFromYAxisZero()?(a=i.paddingLeft,t.axisLine.show&&(a+=t.axisLine.size),s&&(a+=o),this._ctx.textAlign="left"):(a=this._width-i.paddingRight,t.axisLine.show&&(a-=t.axisLine.size),s&&(a-=o),this._ctx.textAlign="right"),this._ctx.textBaseline="middle",this._ctx.font=Mt(i.size,i.weight,i.family),this._ctx.fillStyle=i.color,this._yAxis.ticks().forEach((function(t){e._ctx.fillText(t.v,a,t.y)})),this._ctx.textAlign="left"}}},{key:"_drawTechLastValue",value:function(){var t=this,e=this._chartStore.styleOptions().technicalIndicator,i=e.lastValueMark;if(i.show&&i.text.show){var n=this._chartStore.technicalIndicatorStore().instances(this._paneId),s=this._chartStore.dataList();n.forEach((function(n){var o=n.result||[],r=o.length,h=o[r-1]||{},c={prev:{kLineData:s[r-2],technicalIndicatorData:o[r-2]},current:{kLineData:s[r-1],technicalIndicatorData:h},next:{kLineData:null,technicalIndicatorData:null}},l=n.precision,u=n.styles||e,d=u.line.colors||[],_=d.length,v=0;n.plots.forEach((function(e){var s,o=h[e.key];switch(e.type){case _t:s=e.color&&e.color(c,u)||u.circle.noChangeColor;break;case dt:s=e.color&&e.color(c,u)||u.bar.noChangeColor;break;case ut:s=d[v%_],v++}b(o)&&t._drawMarkLabel(o,l,n.shouldFormatBigNumber,a(a({},i.text),{},{backgroundColor:s}))}))}))}}},{key:"_drawLastPriceLabel",value:function(){if(this._yAxis.isCandleYAxis()){var t=this._chartStore.styleOptions().candle.priceMark,e=t.last;if(t.show&&e.show&&e.text.show){var i=this._chartStore.dataList(),n=i[i.length-1];if(n){var s,o=n.close,r=n.open;s=o>r?e.upColor:r>o?e.downColor:e.noChangeColor,this._drawMarkLabel(o,this._chartStore.pricePrecision(),!1,a(a({},e.text),{},{backgroundColor:s}))}}}}},{key:"_drawMarkLabel",value:function(t,e,i,a){var n,s=a.size,o=a.weight,r=a.family,h=a.color,c=a.backgroundColor,l=a.borderRadius,u=a.paddingLeft,d=a.paddingTop,_=a.paddingRight,v=a.paddingBottom,f=this._yAxis.convertToNicePixel(t);if(this._yAxis.yAxisType()===O){var p=((this._chartStore.visibleDataList()[0]||{}).data||{}).close;n="".concat(((t-p)/p*100).toFixed(2),"%")}else n=at(t,e),i&&(n=nt(n));this._ctx.font=Mt(s,o,r);var m,y=It(this._ctx,n)+u+_,x=d+s+v;m=this._yAxis.isFromYAxisZero()?0:this._width-y,ve(this._ctx,c,m,f-d-s/2,y,x,l),this._ctx.textBaseline="middle",ce(this._ctx,h,m+u,f,n)}}]),i}(re),me=function(t){c(i,t);var e=_(i);function i(t,a,n,o){var r;return s(this,i),(r=e.call(this,t,a))._yAxis=n,r._paneId=o,r}return r(i,[{key:"_draw",value:function(){this._ctx.textBaseline="middle",this._drawTag(),this._drawCrossHairLabel()}},{key:"_drawTag",value:function(){var t=this,e=this._chartStore.tagStore().get(this._paneId);e&&e.forEach((function(e){e.drawText(t._ctx)}))}},{key:"_drawCrossHairLabel",value:function(){var t=this._chartStore.crosshairStore().get();if(t.paneId===this._paneId&&0!==this._chartStore.dataList().length){var e=this._chartStore.styleOptions().crosshair,i=e.horizontal,a=i.text;if(e.show&&i.show&&a.show){var n,s,o=this._yAxis.convertFromPixel(t.y);if(this._yAxis.yAxisType()===O){var r=(this._chartStore.visibleDataList()[0]||{}).data||{};n="".concat(((o-r.close)/r.close*100).toFixed(2),"%")}else{var h=this._chartStore.technicalIndicatorStore().instances(this._paneId),c=0,l=!1;this._yAxis.isCandleYAxis()?c=this._chartStore.pricePrecision():h.forEach((function(t){c=Math.max(t.precision,c),l||(l=t.shouldFormatBigNumber)})),n=at(o,c),l&&(n=nt(n))}var u=a.borderSize,d=Dt(this._ctx,n,a),_=Lt(a);s=this._yAxis.isFromYAxisZero()?0:this._width-d,de(this._ctx,a.backgroundColor,a.borderColor,u,s,t.y-u-a.paddingTop-a.size/2,d,_,a.borderRadius),ce(this._ctx,a.color,s+u+a.paddingLeft,t.y,n)}}}}]),i}(re),ye=function(t){c(i,t);var e=_(i);function i(){return s(this,i),e.apply(this,arguments)}return r(i,[{key:"_createMainView",value:function(t,e){return new pe(t,e.chartStore,e.yAxis,e.paneId)}},{key:"_createOverlayView",value:function(t,e){return new me(t,e.chartStore,e.yAxis,e.paneId)}}]),i}(se),xe=function(){function t(e){s(this,t),this._chartStore=e,this._width=0,this._height=0,this._cacheMinValue=0,this._cacheMaxValue=0,this._minValue=0,this._maxValue=0,this._range=0,this._ticks=[],this._initMeasureCanvas()}return r(t,[{key:"_initMeasureCanvas",value:function(){var t=ae("canvas"),e=Tt(t);this._measureCtx=t.getContext("2d"),this._measureCtx.scale(e,e)}},{key:"min",value:function(){return this._minValue}},{key:"max",value:function(){return this._maxValue}},{key:"width",value:function(){return this._width}},{key:"height",value:function(){return this._height}},{key:"setWidth",value:function(t){this._width=t}},{key:"setHeight",value:function(t){this._height=t}},{key:"ticks",value:function(){return this._ticks}},{key:"computeAxis",value:function(t){var e=this._optimalMinMax(this._computeMinMax());return this._minValue=e.min,this._maxValue=e.max,this._range=e.range,!(this._cacheMinValue===e.min&&this._cacheMaxValue===e.max&&!t)&&(this._cacheMinValue=e.min,this._cacheMaxValue=e.max,this._ticks=this._optimalTicks(this._computeTicks()),!0)}},{key:"_computeMinMax",value:function(){}},{key:"_optimalMinMax",value:function(t){}},{key:"_computeTicks",value:function(){var t=[];if(this._range>=0){var e=this._computeInterval(this._range),i=e.interval,a=e.precision,n=st(Math.ceil(this._minValue/i)*i,a),s=st(Math.floor(this._maxValue/i)*i,a),o=0,r=n;if(0!==i)for(;s>=r;)t[o]={v:r.toFixed(a)},++o,r+=i}return t}},{key:"_optimalTicks",value:function(t){}},{key:"_computeInterval",value:function(t){var e,i,a,n,s=(i=Math.floor(ot(e=t/8)),a=rt(i),e=(1.5>(n=e/a)?1:2.5>n?2:3.5>n?3:4.5>n?4:5.5>n?5:6.5>n?6:8)*a,-20>i?e:+e.toFixed(0>i?-i:0)),o=function(t){var e=""+t,i=e.indexOf("e");if(i>0){var a=+e.slice(i+1);return 0>a?-a:0}var n=e.indexOf(".");return 0>n?0:e.length-1-n}(s);return{interval:s,precision:o}}}]),t}(),ge=function(t){c(i,t);var e=_(i);function i(t,a,n){var o;return s(this,i),(o=e.call(this,t))._realRange=0,o._isCandleYAxis=a,o._paneId=n,o}return r(i,[{key:"_computeMinMax",value:function(){var t,e=this,i=[Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER],a=[],n=!1,s=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER;this._chartStore.technicalIndicatorStore().instances(this._paneId).forEach((function(i){if(n||(n=i.shouldOhlc),r=Math.min(r,i.precision),w(i.minValue)&&(s=Math.min(s,i.minValue)),w(i.maxValue)&&(o=Math.max(o,i.maxValue)),i.styles){t||(t={top:0,bottom:0});var h=i.styles.margin;w(h.top)&&(t.top=Math.max(1>h.top?h.top:h.top/e._height,t.top)),w(h.bottom)&&(t.bottom=Math.max(1>h.bottom?h.bottom:h.bottom/e._height,t.bottom))}a.push({plots:i.plots,result:i.result})}));var h=4;if(this._isCandleYAxis){var c=this._chartStore.pricePrecision();h=r!==Number.MAX_SAFE_INTEGER?Math.min(r,c):c}else r!==Number.MAX_SAFE_INTEGER&&(h=r);var l=this._chartStore.visibleDataList(),u=this._chartStore.styleOptions().candle,d=u.type===Y,_=u.area.value,v=this._isCandleYAxis&&!d||!this._isCandleYAxis&&n;return l.forEach((function(t){var n=t.index,s=t.data;v&&(i[0]=Math.min(i[0],s.low),i[1]=Math.max(i[1],s.high)),e._isCandleYAxis&&d&&(i[0]=Math.min(i[0],s[_]),i[1]=Math.max(i[1],s[_])),a.forEach((function(t){var e=t.result[n]||{};t.plots.forEach((function(t){var a=e[t.key];b(a)&&(i[0]=Math.min(i[0],a),i[1]=Math.max(i[1],a))}))}))})),i[0]!==Number.MAX_SAFE_INTEGER&&i[1]!==Number.MIN_SAFE_INTEGER?(i[0]=Math.min(s,i[0]),i[1]=Math.max(o,i[1])):(i[0]=0,i[1]=10),{min:i[0],max:i[1],precision:h,specifyMin:s,specifyMax:o,techGap:t}}},{key:"_optimalMinMax",value:function(t){var e,i,a=t.precision,n=t.specifyMin,s=t.specifyMax,o=t.techGap,r=t.min,h=t.max,c=this.yAxisType();switch(c){case O:var l=(this._chartStore.visibleDataList()[0]||{}).data||{};w(l.close)&&(r=(r-l.close)/l.close*100,h=(h-l.close)/l.close*100),e=.01;break;case F:r=ot(r),h=ot(h),e=.05*rt(-a);break;default:e=rt(-a)}if(r===h||e>Math.abs(r-h)){var u=n===r,d=s===h;r=u?r:d?r-8*e:r-4*e,h=d?h:u?h+8*e:h+4*e}var _,v=.2;w((i=this._isCandleYAxis?this._chartStore.styleOptions().candle.margin:o?{top:0,bottom:0}:this._chartStore.styleOptions().technicalIndicator.margin).top)&&(_=1>i.top?i.top:i.top/this._height,v=o?Math.max(o.top,_):_);var f,p=.1;w(i.bottom)&&(f=1>i.bottom?i.bottom:i.bottom/this._height,p=o?Math.max(o.bottom,f):f);var m=Math.abs(h-r);return m=Math.abs((h+=m*v)-(r-=m*p)),this._realRange=c===F?Math.abs(rt(h)-rt(r)):m,{min:r,max:h,range:m}}},{key:"_optimalTicks",value:function(t){var e=this,i=[],a=this.yAxisType(),n=this._chartStore.technicalIndicatorStore().instances(this._paneId),s=0,o=!1;this._isCandleYAxis?s=this._chartStore.pricePrecision():n.forEach((function(t){s=Math.max(s,t.precision),o||(o=t.shouldFormatBigNumber)}));var r,h,c=this._chartStore.styleOptions().xAxis.tickText.size;return a===F&&(r=this._computeInterval(this._realRange)),t.forEach((function(t){var n,l=t.v,u=e._innerConvertToPixel(+l);switch(a){case O:n="".concat(at(l,2),"%");break;case F:n=st(rt(l),r.precision),u=e._innerConvertToPixel(ot(n)),n=at(n,s);break;default:n=at(l,s),o&&(n=nt(n))}u>c&&e._height-c>u&&(h&&h-u>2*c||!h)&&(i.push({v:n,y:u}),h=u)})),i}},{key:"_innerConvertToPixel",value:function(t){return Math.round((1-(t-this._minValue)/this._range)*this._height)}},{key:"isCandleYAxis",value:function(){return this._isCandleYAxis}},{key:"yAxisType",value:function(){return this._isCandleYAxis?this._chartStore.styleOptions().yAxis.type:L}},{key:"isFromYAxisZero",value:function(){var t=this._chartStore.styleOptions().yAxis;return t.position===M&&t.inside||t.position===D&&!t.inside}},{key:"getSelfWidth",value:function(){var t=this,e=this._chartStore.styleOptions(),i=e.yAxis,a=i.width;if(w(a))return a;var n=0;if(i.show&&(i.axisLine.show&&(n+=i.axisLine.size),i.tickLine.show&&(n+=i.tickLine.length),i.tickText.show)){var s=0;this._measureCtx.font=Mt(i.tickText.size,i.tickText.weight,i.tickText.family),this._ticks.forEach((function(e){s=Math.max(s,It(t._measureCtx,e.v))})),n+=i.tickText.paddingLeft+i.tickText.paddingRight+s}var o=e.crosshair,r=0;if(o.show&&o.horizontal.show&&o.horizontal.text.show){var h=this._chartStore.technicalIndicatorStore().instances(this._paneId),c=0,l=!1;h.forEach((function(t){c=Math.max(t.precision,c),l||(l=t.shouldFormatBigNumber)})),this._measureCtx.font=Mt(o.horizontal.text.size,o.horizontal.text.weight,o.horizontal.text.family);var u=2;if(this.yAxisType()!==O)if(this._isCandleYAxis){var d=this._chartStore.pricePrecision(),_=e.technicalIndicator.lastValueMark;u=_.show&&_.text.show?Math.max(c,d):d}else u=c;var v=at(this._maxValue,u);l&&(v=nt(v)),r+=o.horizontal.text.paddingLeft+o.horizontal.text.paddingRight+2*o.horizontal.text.borderSize+It(this._measureCtx,v)}return Math.max(n,r)}},{key:"convertFromPixel",value:function(t){var e=(1-t/this._height)*this._range+this._minValue;switch(this.yAxisType()){case O:var i=(this._chartStore.visibleDataList()[0]||{}).data||{};if(w(i.close))return i.close*e/100+i.close;break;case F:return rt(e);default:return e}}},{key:"convertToPixel",value:function(t){var e;switch(this.yAxisType()){case O:var i=(this._chartStore.visibleDataList()[0]||{}).data||{};w(i.close)&&(e=(t-i.close)/i.close*100);break;case F:e=ot(t);break;default:e=t}return this._innerConvertToPixel(e)}},{key:"convertToNicePixel",value:function(t){var e=this.convertToPixel(t);return Math.round(Math.max(.05*this._height,Math.min(e,.98*this._height)))}}]),i}(xe),Se=function(t){c(i,t);var e=_(i);function i(t){var a;return s(this,i),a=e.call(this,t),"height"in t&&a.setHeight(t.height),a}return r(i,[{key:"_initBefore",value:function(t){this._id=t.id,this._yAxis=this._createYAxis(t)}},{key:"_createYAxis",value:function(t){return new ge(t.chartStore,!1,t.id)}},{key:"_createMainWidget",value:function(t,e){return new ue({container:t,chartStore:e.chartStore,xAxis:e.xAxis,yAxis:this._yAxis,paneId:e.id})}},{key:"_createYAxisWidget",value:function(t,e){return new ye({container:t,chartStore:e.chartStore,yAxis:this._yAxis,paneId:e.id})}},{key:"setHeight",value:function(t){f(l(i.prototype),"setHeight",this).call(this,t),this._yAxis.setHeight(t)}},{key:"setWidth",value:function(t,e){f(l(i.prototype),"setWidth",this).call(this,t,e),this._yAxis.setWidth(e)}},{key:"id",value:function(){return this._id}},{key:"yAxis",value:function(){return this._yAxis}}]),i}(ne),ke=function(t){c(i,t);var e=_(i);function i(){return s(this,i),e.apply(this,arguments)}return r(i,[{key:"_drawContent",value:function(){var t=this._chartStore.styleOptions().candle;this._drawLastPriceLine(t.priceMark),t.type===Y?this._drawArea(t):(this._drawLowHighPrice(t.priceMark,"high","high",Number.MIN_SAFE_INTEGER,[-2,-5],(function(t,e){if(t>e)return t})),this._drawLowHighPrice(t.priceMark,"low","low",Number.MAX_SAFE_INTEGER,[2,5],(function(t,e){if(e>t)return t})),this._drawCandle(t)),this._drawTechs(),this._drawGrid()}},{key:"_drawArea",value:function(t){var e=this,i=[],a=[],n=Number.MAX_SAFE_INTEGER,s=t.area;this._drawGraphics((function(t,o,r,h,c,l){var u=r[s.value];if(w(u)){var d=e._yAxis.convertToPixel(u);if(0===l){var _=t-h;a.push({x:_,y:e._height}),a.push({x:_,y:d}),i.push({x:_,y:d})}i.push({x:t,y:d}),a.push({x:t,y:d}),n=Math.min(n,d)}}),(function(){var t=a.length;if(t>0){var o=a[t-1],r=e._chartStore.timeScaleStore().halfBarSpace(),h=o.x+r;i.push({x:h,y:o.y}),a.push({x:h,y:o.y}),a.push({x:h,y:e._height})}if(i.length>0&&(e._ctx.lineWidth=s.lineSize,e._ctx.strokeStyle=s.lineColor,At(e._ctx,i)),a.length>0){var c=s.backgroundColor;if(g(c)){var l=e._ctx.createLinearGradient(0,e._height,0,n);try{c.forEach((function(t){l.addColorStop(t.offset,t.color)}))}catch(t){}e._ctx.fillStyle=l}else e._ctx.fillStyle=c;Et(e._ctx,a)}}))}},{key:"_drawCandle",value:function(t){var e=this;this._drawGraphics((function(i,a,n,s,o){e._drawCandleBar(i,s,o,a,n,t.bar,t.type)}))}},{key:"_drawLowHighPrice",value:function(t,e,i,a,n,s){var o=t[e];if(t.show&&o.show){var r=this._chartStore.visibleDataList(),h=a,c=-1;r.forEach((function(t){var e=t.index,n=s(et(t.data,i,a),h);n&&(h=n,c=e)}));var l=this._chartStore.pricePrecision(),u=this._yAxis.convertToPixel(h),d=this._xAxis.convertToPixel(c),_=u+n[0];this._ctx.textAlign="left",this._ctx.lineWidth=1,this._ctx.strokeStyle=o.color,this._ctx.fillStyle=o.color,At(this._ctx,[{x:d-2,y:_+n[0]},{x:d,y:_},{x:d+2,y:_+n[0]}]);var v=_+n[1];At(this._ctx,[{x:d,y:_},{x:d,y:v},{x:d+5,y:v}]),this._ctx.font=Mt(o.textSize,o.textWeight,o.textFamily);var f=at(h,l);this._ctx.textBaseline="middle",this._ctx.fillText(f,d+5+o.textMargin,v)}}},{key:"_drawLastPriceLine",value:function(t){var e=t.last;if(t.show&&e.show&&e.line.show){var i=this._chartStore.dataList(),a=i[i.length-1];if(a){var n,s=a.close,o=a.open,r=this._yAxis.convertToNicePixel(s);n=s>o?e.upColor:o>s?e.downColor:e.noChangeColor,this._ctx.save(),this._ctx.strokeStyle=n,this._ctx.lineWidth=e.line.size,e.line.style===T&&this._ctx.setLineDash(e.line.dashValue),Pt(this._ctx,r,0,this._width),this._ctx.restore()}}}}]),i}(he),we=function(t){c(i,t);var e=_(i);function i(){return s(this,i),e.apply(this,arguments)}return r(i,[{key:"_drawTooltip",value:function(t,e){var i=this._chartStore.styleOptions(),a=i.candle,n=a.tooltip,s=i.technicalIndicator,o=s.tooltip,r=this._shouldDrawTooltip(t,n),h=this._shouldDrawTooltip(t,o);n.showType===j&&o.showType===j?this._drawCandleTooltipWithRect(t,e,a,r,s,h):n.showType===X?(this._drawCandleTooltipWithStandard(t.kLineData,a,r),o.showType===X?this._drawBatchTechToolTip(t,e,s,r?n.text.size+n.text.marginTop:0,h):this._drawCandleTooltipWithRect(t,e,a,!1,s,h)):(this._drawCandleTooltipWithRect(t,e,a,r,s,!1),this._drawBatchTechToolTip(t,e,s,0,h))}},{key:"_drawCandleTooltipWithStandard",value:function(t,e,i){var a=this;if(i){var n=this._getCandleTooltipData(t,e),s=e.tooltip,o=s.text.marginLeft,r=s.text.marginRight,h=s.text.size,c=s.text.color,l=s.labels;this._ctx.textBaseline="top",this._ctx.font=Mt(h,s.text.weight,s.text.family);var u=o,d=s.text.marginTop;l.forEach((function(t,e){var i=It(a._ctx,t);ce(a._ctx,c,u,d,t),u+=i;var h,l,_=n[e]||s.defaultValue;k(_)?(h=_.value||s.defaultValue,l=_.color||c):(l=c,h=_);var v=It(a._ctx,h);ce(a._ctx,l,u,d,h),u+=v+o+r}))}}},{key:"_drawCandleTooltipWithRect",value:function(t,e,i,a,n,s){var o=this;if(a||s){var r=i.tooltip,h=r.labels,c=this._getCandleTooltipData(t.kLineData,i),l=r.text.marginLeft,u=r.text.marginRight,d=r.text.marginTop,_=r.text.marginBottom,v=r.text.size,f=r.text.color,p=r.rect,m=p.borderSize,y=p.paddingLeft,x=p.paddingRight,g=p.paddingTop,S=p.paddingBottom,w=p.offsetLeft,E=p.offsetRight,P=0,C=0,A=0;this._ctx.save(),this._ctx.textBaseline="top",a&&(this._ctx.font=Mt(v,r.text.weight,r.text.family),h.forEach((function(t,e){var i,a=c[e];i=k(a)?a.value||r.defaultValue:a;var n="".concat(t).concat(i),s=It(o._ctx,n)+l+u;P=Math.max(P,s)})),A+=(_+d+v)*h.length);var T=n.tooltip,I=T.text.marginLeft,M=T.text.marginRight,D=T.text.marginTop,L=T.text.marginBottom,O=T.text.size,F=e.map((function(e){return o._getTechTooltipData(t,e,n)}));if(s&&(this._ctx.font=Mt(O,T.text.weight,T.text.family),F.forEach((function(t){t.values.forEach((function(t){var e=t.title,i=t.value;if(b(e)){var a="".concat(e).concat(i),n=It(o._ctx,a)+I+M;P=Math.max(P,n),A+=D+L+O}}))}))),0!==(C+=P)&&0!==A){var z;C+=2*m+y+x;var R=p.offsetTop,B=p.borderRadius;ve(this._ctx,p.backgroundColor,z=this._width/2>t.realX?this._width-E-C:w,R,C,A+=2*m+g+S,B),_e(this._ctx,p.borderColor,m,z,R,C,A,B);var H=z+m+y+l,V=R+m+g;if(a&&(this._ctx.font=Mt(v,r.text.weight,r.text.family),h.forEach((function(t,e){V+=d,o._ctx.textAlign="left",ce(o._ctx,f,H,V,t);var i,a,n=c[e];k(n)?(a=n.color||f,i=n.value||r.defaultValue):(a=f,i=n||r.defaultValue),o._ctx.textAlign="right",ce(o._ctx,a,z+C-m-u-x,V,i),V+=v+_}))),s){var Y=z+m+y+I;this._ctx.font=Mt(O,T.text.weight,T.text.family),F.forEach((function(t){t.values.forEach((function(t){V+=D,o._ctx.textAlign="left",o._ctx.fillStyle=t.color,o._ctx.fillText(t.title,Y,V),o._ctx.textAlign="right",o._ctx.fillText(t.value,z+C-m-M-x,V),V+=O+L}))}))}this._ctx.restore()}}}},{key:"_getCandleTooltipData",value:function(t,e){var i=this,a=e.tooltip.values,n=[];if(a)S(a)?n=a(t,e)||[]:g(a)&&(n=a);else{var s=this._chartStore.pricePrecision(),o=this._chartStore.volumePrecision();(n=[et(t,"timestamp"),et(t,"open"),et(t,"close"),et(t,"high"),et(t,"low"),et(t,"volume")]).forEach((function(t,e){switch(e){case 0:n[e]=it(i._chartStore.timeScaleStore().dateTimeFormat(),t,"YYYY-MM-DD hh:mm");break;case n.length-1:n[e]=nt(at(t,o));break;default:n[e]=at(t,s)}}))}return n}}]),i}(le),be=function(t){c(i,t);var e=_(i);function i(){return s(this,i),e.apply(this,arguments)}return r(i,[{key:"_createMainView",value:function(t,e){return new ke(t,e.chartStore,e.xAxis,e.yAxis,e.paneId)}},{key:"_createOverlayView",value:function(t,e){return new we(t,e.chartStore,e.xAxis,e.yAxis,e.paneId)}}]),i}(ue),Ee=function(t){c(i,t);var e=_(i);function i(){return s(this,i),e.apply(this,arguments)}return r(i,[{key:"_createYAxis",value:function(t){return new ge(t.chartStore,!0,t.id)}},{key:"_createMainWidget",value:function(t,e){return new be({container:t,chartStore:e.chartStore,xAxis:e.xAxis,yAxis:this._yAxis,paneId:e.id})}}]),i}(Se),Pe=function(t){c(i,t);var e=_(i);function i(t,a,n){var o;return s(this,i),(o=e.call(this,t,a))._xAxis=n,o}return r(i,[{key:"_draw",value:function(){var t=this._chartStore.styleOptions().xAxis;t.show&&(this._drawAxisLine(t),this._drawTickLines(t),this._drawTickLabels(t))}},{key:"_drawAxisLine",value:function(t){var e=t.axisLine;e.show&&(this._ctx.strokeStyle=e.color,this._ctx.lineWidth=e.size,Pt(this._ctx,0,0,this._width))}},{key:"_drawTickLines",value:function(t){var e=this,i=t.tickLine;if(i.show){this._ctx.lineWidth=i.size,this._ctx.strokeStyle=i.color;var a=t.axisLine.show?t.axisLine.size:0,n=a+i.length;this._xAxis.ticks().forEach((function(t){Ct(e._ctx,t.x,a,n)}))}}},{key:"_drawTickLabels",value:function(t){var e=t.tickText;if(e.show){var i=t.tickLine;this._ctx.textBaseline="top",this._ctx.font=Mt(e.size,e.weight,e.family),this._ctx.textAlign="center",this._ctx.fillStyle=e.color;var a=e.paddingTop;t.axisLine.show&&(a+=t.axisLine.size),i.show&&(a+=i.length);for(var n=this._xAxis.ticks(),s=n.length,o=0;s>o;o++)this._ctx.fillText(n[o].v,n[o].x,a)}}}]),i}(re),Ce=function(t){c(i,t);var e=_(i);function i(t,a,n){var o;return s(this,i),(o=e.call(this,t,a))._xAxis=n,o}return r(i,[{key:"_draw",value:function(){this._drawCrosshairLabel()}},{key:"_drawCrosshairLabel",value:function(){var t=this._chartStore.crosshairStore().get();if(t.paneId){var e=this._chartStore.styleOptions().crosshair,i=e.vertical,a=i.text;if(e.show&&i.show&&a.show&&t.dataIndex===t.realDataIndex){var n=t.kLineData.timestamp,s=it(this._chartStore.timeScaleStore().dateTimeFormat(),n,"YYYY-MM-DD hh:mm"),o=a.paddingLeft,r=a.paddingRight,h=a.paddingTop,c=a.borderSize,l=Dt(this._ctx,s,a),u=Lt(a),d=l-2*c-o-r,_=t.realX-d/2;o+c>_?_=o+c:_>this._width-d-c-r&&(_=this._width-d-c-r),de(this._ctx,a.backgroundColor,a.borderColor,c,_-c-o,0,l,u,a.borderRadius),this._ctx.textBaseline="top",ce(this._ctx,a.color,_,c+h,s)}}}}]),i}(re),Ae=function(t){c(i,t);var e=_(i);function i(){return s(this,i),e.apply(this,arguments)}return r(i,[{key:"_createMainView",value:function(t,e){return new Pe(t,e.chartStore,e.xAxis)}},{key:"_createOverlayView",value:function(t,e){return new Ce(t,e.chartStore,e.xAxis)}}]),i}(se),Te=function(t){c(i,t);var e=_(i);function i(){return s(this,i),e.apply(this,arguments)}return r(i,[{key:"_computeMinMax",value:function(){return{min:this._chartStore.timeScaleStore().from(),max:this._chartStore.timeScaleStore().to()-1}}},{key:"_optimalMinMax",value:function(t){var e=t.min,i=t.max;return{min:e,max:i,range:i-e+1}}},{key:"_optimalTicks",value:function(t){var e=[],i=t.length,a=this._chartStore.dataList();if(i>0){var n=this._chartStore.timeScaleStore().dateTimeFormat(),s=this._chartStore.styleOptions().xAxis.tickText;this._measureCtx.font=Mt(s.size,s.weight,s.family);var o=It(this._measureCtx,"00-00 00:00"),r=this.convertToPixel(parseInt(t[0].v,10)),h=1;if(i>1){var c=this.convertToPixel(parseInt(t[1].v,10)),l=Math.abs(c-r);o>l&&(h=Math.ceil(o/l))}for(var u=0;i>u;u+=h){var d=parseInt(t[u].v,10),_=a[d].timestamp,v=it(n,_,"hh:mm");if(0!==u)v=this._optimalTickLabel(n,_,a[parseInt(t[u-h].v,10)].timestamp)||v;var f=this.convertToPixel(d);e.push({v:v,x:f,oV:_})}if(1===e.length)e[0].v=it(n,e[0].oV,"YYYY-MM-DD hh:mm");else{var p=e[0].oV,m=e[1].oV;if(e[2]){var y=e[2].v;/^[0-9]{2}-[0-9]{2}$/.test(y)?e[0].v=it(n,p,"MM-DD"):/^[0-9]{4}-[0-9]{2}$/.test(y)?e[0].v=it(n,p,"YYYY-MM"):/^[0-9]{4}$/.test(y)&&(e[0].v=it(n,p,"YYYY"))}else e[0].v=this._optimalTickLabel(n,p,m)||e[0].v}}return e}},{key:"_optimalTickLabel",value:function(t,e,i){var a=it(t,e,"YYYY"),n=it(t,e,"YYYY-MM"),s=it(t,e,"MM-DD");return a!==it(t,i,"YYYY")?a:n!==it(t,i,"YYYY-MM")?n:s!==it(t,i,"MM-DD")?s:null}},{key:"getSelfHeight",value:function(){var t=this._chartStore.styleOptions(),e=t.xAxis,i=e.height;if(w(i))return i;var a=t.crosshair,n=0;e.show&&(e.axisLine.show&&(n+=e.axisLine.size),e.tickLine.show&&(n+=e.tickLine.length),e.tickText.show&&(n+=e.tickText.paddingTop+e.tickText.paddingBottom+e.tickText.size));var s=0;return a.show&&a.vertical.show&&a.vertical.text.show&&(s+=a.vertical.text.paddingTop+a.vertical.text.paddingBottom+2*a.vertical.text.borderSize+a.vertical.text.size),Math.max(n,s)}},{key:"convertFromPixel",value:function(t){return this._chartStore.timeScaleStore().coordinateToDataIndex(t)}},{key:"convertToPixel",value:function(t){return this._chartStore.timeScaleStore().dataIndexToCoordinate(t)}}]),i}(xe),Ie=function(t){c(i,t);var e=_(i);function i(){return s(this,i),e.apply(this,arguments)}return r(i,[{key:"_initBefore",value:function(){this._xAxis=new Te(this._chartStore)}},{key:"_createMainWidget",value:function(t,e){return new Ae({container:t,chartStore:e.chartStore,xAxis:this._xAxis})}},{key:"xAxis",value:function(){return this._xAxis}},{key:"setWidth",value:function(t,e){f(l(i.prototype),"setWidth",this).call(this,t,e),this._xAxis.setWidth(t)}},{key:"setHeight",value:function(t){f(l(i.prototype),"setHeight",this).call(this,t),this._xAxis.setHeight(t)}}]),i}(ne),Me="mouse",De="touch";function Le(t){return t.type===De}function Oe(t){return t.type===Me}var Fe=0,ze=2;function Re(t){return t.getBoundingClientRect()||{left:0,top:0}}function Be(t){return!!t.touches}function He(t){t.cancelable&&t.preventDefault()}function Ve(t,e){var i=t.clientX-e.clientX,a=t.clientY-e.clientY;return Math.sqrt(i*i+a*a)}var Ye=function(){function t(e,i,a){s(this,t),this._target=e,this._handler=i,this._options=a,this._clickCount=0,this._clickTimeoutId=null,this._longTapTimeoutId=null,this._longTapActive=!1,this._mouseMoveStartPosition=null,this._moveExceededManhattanDistance=!1,this._cancelClick=!1,this._unsubscribeOutsideEvents=null,this._unsubscribeMousemove=null,this._unsubscribeRoot=null,this._startPinchMiddleCoordinate=null,this._startPinchDistance=0,this._pinchPrevented=!1,this._preventDragProcess=!1,this._mousePressed=!1,this._init()}return r(t,[{key:"setOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._options=a(a({},this.options),t)}},{key:"destroy",value:function(){null!==this._unsubscribeOutsideEvents&&(this._unsubscribeOutsideEvents(),this._unsubscribeOutsideEvents=null),null!==this._unsubscribeMousemove&&(this._unsubscribeMousemove(),this._unsubscribeMousemove=null),null!==this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null),this._clearLongTapTimeout(),this._resetClickTimeout()}},{key:"_mouseEnterHandler",value:function(t){var e=this;this._unsubscribeMousemove&&this._unsubscribeMousemove();var i=this._mouseMoveHandler.bind(this),a=this._mouseWheelHandler.bind(this);this._unsubscribeMousemove=function(){e._target.removeEventListener("mousemove",i),e._target.removeEventListener("wheel",a)},this._target.addEventListener("mousemove",i),this._target.addEventListener("wheel",a,{passive:!1}),Be(t)&&this._mouseMoveHandler(t);var n=this._makeCompatEvent(t);this._processEvent(n,this._handler.mouseEnterEvent)}},{key:"_resetClickTimeout",value:function(){null!==this._clickTimeoutId&&clearTimeout(this._clickTimeoutId),this._clickCount=0,this._clickTimeoutId=null}},{key:"_mouseMoveHandler",value:function(t){if(!this._mousePressed||Be(t)){var e=this._makeCompatEvent(t);this._processEvent(e,this._handler.mouseMoveEvent)}}},{key:"_mouseWheelHandler",value:function(t){var e=this._makeCompatEvent(t);t.localX=e.localX,t.localY=e.localY,this._processEvent(t,this._handler.mouseWheelEvent)}},{key:"_mouseMoveWithDownHandler",value:function(t){if((!("button"in t)||t.button===Fe)&&null===this._startPinchMiddleCoordinate){var e=Be(t);if(!this._preventDragProcess||!e){this._pinchPrevented=!0;var i=this._makeCompatEvent(t),a=this._mouseMoveStartPosition,n=Math.abs(a.x-i.pageX),s=Math.abs(a.y-i.pageY),o=n+s>5;if(o||!e){if(o&&!this._moveExceededManhattanDistance&&e){var r=.5*n;s>=r&&!this._options.treatVertTouchDragAsPageScroll||r>s&&!this._options.treatHorzTouchDragAsPageScroll||(this._preventDragProcess=!0)}o&&(this._moveExceededManhattanDistance=!0,this._cancelClick=!0,e&&this._clearLongTapTimeout()),this._preventDragProcess||(this._processEvent(i,this._handler.pressedMouseMoveEvent),e&&He(t))}}}}},{key:"_mouseUpHandler",value:function(t){if(!("button"in t)||t.button===Fe){var e=this._makeCompatEvent(t);this._clearLongTapTimeout(),this._mouseMoveStartPosition=null,this._mousePressed=!1,this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null),Be(t)&&this._mouseLeaveHandler(t),this._processEvent(e,this._handler.mouseUpEvent),++this._clickCount,this._clickTimeoutId&&this._clickCount>1?(this._processEvent(e,this._handler.mouseDoubleClickEvent),this._resetClickTimeout()):this._cancelClick||this._processEvent(e,this._handler.mouseClickEvent),Be(t)&&(He(t),this._mouseLeaveHandler(t),0===t.touches.length&&(this._longTapActive=!1))}}},{key:"_clearLongTapTimeout",value:function(){null!==this._longTapTimeoutId&&(clearTimeout(this._longTapTimeoutId),this._longTapTimeoutId=null)}},{key:"_mouseDownHandler",value:function(t){if(!("button"in t)||t.button===Fe||t.button===ze){var e=this._makeCompatEvent(t);if("button"in t&&t.button===ze)this._processEvent(e,this._handler.mouseRightDownEvent);else{this._cancelClick=!1,this._moveExceededManhattanDistance=!1,this._preventDragProcess=!1,Be(t)&&this._mouseEnterHandler(t),this._mouseMoveStartPosition={x:e.pageX,y:e.pageY},this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null);var i=this._mouseMoveWithDownHandler.bind(this),a=this._mouseUpHandler.bind(this),n=this._target.ownerDocument.documentElement;this._unsubscribeRoot=function(){n.removeEventListener("touchmove",i),n.removeEventListener("touchend",a),n.removeEventListener("mousemove",i),n.removeEventListener("mouseup",a)},n.addEventListener("touchmove",i,{passive:!1}),n.addEventListener("touchend",a,{passive:!1}),this._clearLongTapTimeout(),Be(t)&&1===t.touches.length?this._longTapTimeoutId=setTimeout(this._longTapHandler.bind(this,t),600):(n.addEventListener("mousemove",i),n.addEventListener("mouseup",a)),this._mousePressed=!0,this._processEvent(e,this._handler.mouseDownEvent),this._clickTimeoutId||(this._clickCount=0,this._clickTimeoutId=setTimeout(this._resetClickTimeout.bind(this),500))}}}},{key:"_init",value:function(){var t=this;this._target.addEventListener("mouseenter",this._mouseEnterHandler.bind(this)),this._target.addEventListener("touchcancel",this._clearLongTapTimeout.bind(this));var e,i=this._target.ownerDocument,a=function(e){t._handler.mouseDownOutsideEvent&&(e.target&&t._target.contains(e.target)||t._handler.mouseDownOutsideEvent())};this._unsubscribeOutsideEvents=function(){i.removeEventListener("mousedown",a),i.removeEventListener("touchstart",a)},i.addEventListener("mousedown",a),i.addEventListener("touchstart",a,{passive:!0}),this._target.addEventListener("mouseleave",this._mouseLeaveHandler.bind(this)),this._target.addEventListener("touchstart",this._mouseDownHandler.bind(this),{passive:!0}),e="ontouchstart"in window||!!(window.DocumentTouch&&document instanceof window.DocumentTouch),"onorientationchange"in window&&(navigator.maxTouchPoints||navigator.msMaxTouchPoints||e)||this._target.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this._initPinch(),this._target.addEventListener("touchmove",(function(){}),{passive:!1})}},{key:"_initPinch",value:function(){var t=this;void 0===this._handler.pinchStartEvent&&void 0===this._handler.pinchEvent&&void 0===this._handler.pinchEndEvent||(this._target.addEventListener("touchstart",(function(e){return t._checkPinchState(e.touches)}),{passive:!0}),this._target.addEventListener("touchmove",(function(e){if(2===e.touches.length&&null!==t._startPinchMiddleCoordinate&&void 0!==t._handler.pinchEvent){var i=Ve(e.touches[0],e.touches[1]);t._handler.pinchEvent(t._startPinchMiddleCoordinate,i/t._startPinchDistance),He(e)}}),{passive:!1}),this._target.addEventListener("touchend",(function(e){t._checkPinchState(e.touches)})))}},{key:"_checkPinchState",value:function(t){1===t.length&&(this._pinchPrevented=!1),2!==t.length||this._pinchPrevented||this._longTapActive?this._stopPinch():this._startPinch(t)}},{key:"_startPinch",value:function(t){var e=Re(this._target);this._startPinchMiddleCoordinate={x:(t[0].clientX-e.left+(t[1].clientX-e.left))/2,y:(t[0].clientY-e.top+(t[1].clientY-e.top))/2},this._startPinchDistance=Ve(t[0],t[1]),void 0!==this._handler.pinchStartEvent&&this._handler.pinchStartEvent(),this._clearLongTapTimeout()}},{key:"_stopPinch",value:function(){null!==this._startPinchMiddleCoordinate&&(this._startPinchMiddleCoordinate=null,void 0!==this._handler.pinchEndEvent&&this._handler.pinchEndEvent())}},{key:"_mouseLeaveHandler",value:function(t){this._unsubscribeMousemove&&this._unsubscribeMousemove();var e=this._makeCompatEvent(t);this._processEvent(e,this._handler.mouseLeaveEvent)}},{key:"_longTapHandler",value:function(t){var e=this._makeCompatEvent(t);this._processEvent(e,this._handler.longTapEvent),this._cancelClick=!0,this._longTapActive=!0}},{key:"_processEvent",value:function(t,e){e&&e.call(this._handler,t)}},{key:"_makeCompatEvent",value:function(t){var e;e="touches"in t&&t.touches.length?t.touches[0]:"changedTouches"in t&&t.changedTouches.length?t.changedTouches[0]:t;var i=Re(this._target);return{clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY,screenX:e.screenX,screenY:e.screenY,localX:e.clientX-i.left,localY:e.clientY-i.top,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,type:t.type.startsWith("mouse")?Me:De,target:e.target,view:t.view}}}]),t}(),We=function(){function t(e,i,a,n,o,r){s(this,t),this._chartStore=i,this._topPaneId=a,this._bottomPaneId=n,this._dragEnabled=o,this._width=0,this._offsetLeft=0,this._dragEventHandler=r,this._dragFlag=!1,this._initElement(e),this._initEvent(o)}return r(t,[{key:"_initElement",value:function(t){this._container=t,this._wrapper=ae("div",{margin:"0",padding:"0",position:"relative",boxSizing:"border-box"}),this._element=ae("div",{width:"100%",height:"7px",margin:"0",padding:"0",position:"absolute",top:"-3px",zIndex:"20",boxSizing:"border-box"}),this._wrapper.appendChild(this._element);var e=t.lastChild;e?t.insertBefore(this._wrapper,e):t.appendChild(this._wrapper)}},{key:"_initEvent",value:function(t){t&&(this._element.style.cursor="ns-resize",this._dragEvent=new Ye(this._element,{mouseDownEvent:this._mouseDownEvent.bind(this),mouseUpEvent:this._mouseUpEvent.bind(this),pressedMouseMoveEvent:this._pressedMouseMoveEvent.bind(this),mouseEnterEvent:this._mouseEnterEvent.bind(this),mouseLeaveEvent:this._mouseLeaveEvent.bind(this)},{treatVertTouchDragAsPageScroll:!1,treatHorzTouchDragAsPageScroll:!0}))}},{key:"_mouseDownEvent",value:function(t){this._dragFlag=!0,this._startY=t.pageY,this._dragEventHandler.startDrag(this._topPaneId,this._bottomPaneId)}},{key:"_mouseUpEvent",value:function(){this._dragFlag=!1,this._chartStore.setDragPaneFlag(!1)}},{key:"_pressedMouseMoveEvent",value:function(t){this._dragEventHandler.drag(t.pageY-this._startY,this._topPaneId,this._bottomPaneId),this._chartStore.setDragPaneFlag(!0),this._chartStore.crosshairStore().set()}},{key:"_mouseEnterEvent",value:function(){var t=this._chartStore.styleOptions().separator;this._element.style.background=t.activeBackgroundColor,this._chartStore.crosshairStore().set()}},{key:"_mouseLeaveEvent",value:function(){this._dragFlag||(this._element.style.background=null,this._chartStore.setDragPaneFlag(!1))}},{key:"height",value:function(){return this._wrapper.offsetHeight}},{key:"setSize",value:function(t,e){this._offsetLeft=t,this._width=e,this.invalidate()}},{key:"setDragEnabled",value:function(t){t!==this._dragEnabled&&(this._dragEnabled=t,t?!this._dragEvent&&this._initEvent(t):(this._element.style.cursor="default",this._dragEvent&&this._dragEvent.destroy(),this._dragEvent=null))}},{key:"topPaneId",value:function(){return this._topPaneId}},{key:"bottomPaneId",value:function(){return this._bottomPaneId}},{key:"updatePaneId",value:function(t,e){b(t)&&(this._topPaneId=t),b(e)&&(this._bottomPaneId=e)}},{key:"invalidate",value:function(){var t=this._chartStore.styleOptions().separator;this._element.style.top="".concat(-Math.floor((7-t.size)/2),"px"),this._wrapper.style.backgroundColor=t.color,this._wrapper.style.height="".concat(t.size,"px"),this._wrapper.style.marginLeft="".concat(t.fill?0:this._offsetLeft,"px"),this._wrapper.style.width=t.fill?"100%":"".concat(this._width,"px")}},{key:"getImage",value:function(){var t=this._chartStore.styleOptions().separator,e=this._wrapper.offsetWidth,i=t.size,a=ae("canvas",{width:"".concat(e,"px"),height:"".concat(i,"px"),boxSizing:"border-box"}),n=a.getContext("2d"),s=Tt(a);return a.width=e*s,a.height=i*s,n.scale(s,s),n.fillStyle=t.color,n.fillRect(this._offsetLeft,0,e,i),a}},{key:"destroy",value:function(){this._dragEvent&&this._dragEvent.destroy(),this._container.removeChild(this._wrapper)}}]),t}(),Ne=r((function t(e){s(this,t),this._chartStore=e})),je=function(t){c(i,t);var e=_(i);function i(t){var a;return s(this,i),(a=e.call(this,t))._startScrollCoordinate=null,a._touchCoordinate=null,a._touchCancelCrosshair=!1,a._touchZoomed=!1,a._pinchScale=1,a}return r(i,[{key:"pinchStartEvent",value:function(){this._pinchScale=1,this._touchZoomed=!0}},{key:"pinchEvent",value:function(t,e){var i=5*(e-this._pinchScale);this._pinchScale=e,this._chartStore.timeScaleStore().zoom(i,t)}},{key:"mouseUpEvent",value:function(){this._startScrollCoordinate=null}},{key:"mouseLeaveEvent",value:function(t){this._startScrollCoordinate=null,Oe(t)&&this._chartStore.crosshairStore().set()}},{key:"mouseMoveEvent",value:function(t){Oe(t)&&this._chartStore.crosshairStore().set({x:t.localX,y:t.paneY,paneId:t.paneId})}},{key:"mouseWheelEvent",value:function(t){if(Math.abs(t.deltaX)>Math.abs(t.deltaY)){if(t.cancelable&&t.preventDefault(),0===Math.abs(t.deltaX))return;this._chartStore.timeScaleStore().startScroll(),this._chartStore.timeScaleStore().scroll(-t.deltaX)}else{var e=-t.deltaY/100;if(0===e)return;switch(t.cancelable&&t.preventDefault(),t.deltaMode){case t.DOM_DELTA_PAGE:e*=120;break;case t.DOM_DELTA_LINE:e*=32}if(0!==e){var i=Math.sign(e)*Math.min(1,Math.abs(e));this._chartStore.timeScaleStore().zoom(i,{x:t.localX,y:t.localY})}}}},{key:"mouseClickEvent",value:function(t){Le(t)&&(this._touchCoordinate||this._touchCancelCrosshair||this._touchZoomed||(this._touchCoordinate={x:t.localX,y:t.localY},this._chartStore.crosshairStore().set({x:t.localX,y:t.paneY,paneId:t.paneId})))}},{key:"mouseDownEvent",value:function(t){if(this._startScrollCoordinate={x:t.localX,y:t.localY},this._chartStore.timeScaleStore().startScroll(),Le(t))if(this._touchZoomed=!1,this._touchCoordinate){var e=t.localX-this._touchCoordinate.x,i=t.localY-this._touchCoordinate.y;10>Math.sqrt(e*e+i*i)?(this._touchCoordinate={x:t.localX,y:t.localY},this._chartStore.crosshairStore().set({x:t.localX,y:t.paneY,paneId:t.paneId})):(this._touchCancelCrosshair=!0,this._touchCoordinate=null,this._chartStore.crosshairStore().set())}else this._touchCancelCrosshair=!1}},{key:"pressedMouseMoveEvent",value:function(t){var e={x:t.localX,y:t.paneY,paneId:t.paneId};if(Le(t)){if(this._touchCoordinate)return this._touchCoordinate={x:t.localX,y:t.localY},void this._chartStore.crosshairStore().set(e);e=null}if(this._startScrollCoordinate){var i=t.localX-this._startScrollCoordinate.x;this._chartStore.timeScaleStore().scroll(i,e)}}},{key:"longTapEvent",value:function(t){Le(t)&&(this._touchCoordinate={x:t.localX,y:t.localY},this._chartStore.crosshairStore().set({x:t.localX,y:t.paneY,paneId:t.paneId}))}}]),i}(Ne),Xe=function(t){c(i,t);var e=_(i);function i(t,a){var n;return s(this,i),(n=e.call(this,t))._yAxis=a,n}return r(i,[{key:"_performOverlayMouseHover",value:function(t,e,i,a){var n;if(t){var s,o=m(t);try{for(o.s();!(s=o.n()).done;){if(n=s.value.checkEventCoordinateOn(i))break}}catch(t){o.e(t)}finally{o.f()}n&&e.id===n.id||(e.id&&e.instance&&Oe(a)&&e.instance.onMouseLeave({id:e.id,points:e.instance.points(),event:a}),n&&n.id!==e.id&&n.instance&&Oe(a)&&n.instance.onMouseEnter({id:n.id,points:n.instance.points(),event:a}))}return n}},{key:"mouseUpEvent",value:function(){this._chartStore.shapeStore().updatePressedInstance()}},{key:"mouseMoveEvent",value:function(t){if(this._waitingForMouseMove)return!1;this._waitingForMouseMove=!0;var e,i,a,n={x:t.localX,y:t.paneY},s=this._chartStore.shapeStore().progressInstance(),o=s.paneId,r=s.instance;if(r&&r.isDrawing())t.paneId&&(r.isStart()&&this._chartStore.shapeStore().updateProgressInstance(this._yAxis(t.paneId),t.paneId),o===t.paneId&&r.mouseMoveForDrawing(n,t),e=r.checkEventCoordinateOn(n)),i={id:"",element:zt,elementIndex:-1};else{var h=this._chartStore.annotationStore().get(t.paneId),c=this._chartStore.shapeStore().instances(t.paneId),l=this._chartStore.shapeStore().mouseOperate().hover,u=this._chartStore.annotationStore().mouseOperate();e=this._performOverlayMouseHover(c,l,n,t),a=this._performOverlayMouseHover(h,u,n,t)}this._chartStore.shapeStore().setMouseOperate({hover:e||{id:"",element:zt,elementIndex:-1},click:i}),this._chartStore.annotationStore().setMouseOperate(a||{id:""}),this._waitingForMouseMove=!1}},{key:"mouseDownEvent",value:function(t){var e,i={x:t.localX,y:t.paneY},n=this._chartStore.shapeStore().progressInstance(),s=n.instance,o=n.paneId,r={id:"",element:zt,elementIndex:-1};if(s&&s.isDrawing()&&o===t.paneId)s.mouseLeftButtonDownForDrawing(),e=s.checkEventCoordinateOn(i);else{var h,c=m(this._chartStore.shapeStore().instances(t.paneId));try{for(c.s();!(h=c.n()).done;){var l=h.value;if(e=l.checkEventCoordinateOn(i)){this._chartStore.shapeStore().updatePressedInstance(l,t.paneId,e.element),e.element===Ft?r=a({},e):l.startPressedOtherMove(i),l.onClick({id:e.id,points:l.points(),event:t});break}}}catch(t){c.e(t)}finally{c.f()}var u=this._chartStore.annotationStore().get(t.paneId);if(u){var d,_=m(u);try{for(_.s();!(d=_.n()).done;){var v=d.value,f=v.checkEventCoordinateOn(i);if(f){v.onClick({id:f.id,points:v.points(),event:t});break}}}catch(t){_.e(t)}finally{_.f()}}}this._chartStore.shapeStore().setMouseOperate({hover:r,click:e||{id:"",element:zt,elementIndex:-1}})&&this._chartStore.invalidate(Zt)}},{key:"mouseRightDownEvent",value:function(t){var e,i=this._chartStore.shapeStore().progressInstance().instance;i?e=i:e=this._chartStore.shapeStore().instances(t.paneId).find((function(e){return e.checkEventCoordinateOn({x:t.localX,y:t.paneY})}));e&&!e.onRightClick({id:e.id(),points:e.points(),event:t})&&this._chartStore.shapeStore().removeInstance(e.id());var a=this._chartStore.annotationStore().get(t.paneId);if(a){var n=a.find((function(e){return e.checkEventCoordinateOn({x:t.localX,y:t.paneY})}));n&&n.onRightClick({id:n.id(),points:n.points(),event:t})}}},{key:"pressedMouseMoveEvent",value:function(t){var e=this._chartStore.shapeStore().pressedInstance(),i=e.instance;if(i&&e.paneId===t.paneId){var a={x:t.localX,y:t.paneY};e.element===Ft?i.mousePressedPointMove(a,t):i.mousePressedOtherMove(a,t),this._chartStore.crosshairStore().set({x:t.localX,y:t.paneY,paneId:t.paneId})}}}]),i}(Ne),Ge="Equal",Ze="Minus",Ue="ArrowLeft",Ke="ArrowRight",qe=function(t){c(i,t);var e=_(i);function i(){return s(this,i),e.apply(this,arguments)}return r(i,[{key:"keyBoardDownEvent",value:function(t){if(t.shiftKey)switch(t.code){case Ge:this._chartStore.timeScaleStore().zoom(.5);break;case Ze:this._chartStore.timeScaleStore().zoom(-.5);break;case Ue:this._chartStore.timeScaleStore().startScroll(),this._chartStore.timeScaleStore().scroll(-3*this._chartStore.timeScaleStore().dataSpace());break;case Ke:this._chartStore.timeScaleStore().startScroll(),this._chartStore.timeScaleStore().scroll(3*this._chartStore.timeScaleStore().dataSpace())}}}]),i}(Ne),$e=function(){function t(e,i,a){s(this,t),this._target=e,this._chartStore=i,this._chartContentLeftRight={},this._chartContentTopBottom={},this._paneContentSize={},this._event=new Ye(this._target,{pinchStartEvent:this._pinchStartEvent.bind(this),pinchEvent:this._pinchEvent.bind(this),mouseUpEvent:this._mouseUpEvent.bind(this),mouseClickEvent:this._mouseClickEvent.bind(this),mouseDownEvent:this._mouseDownEvent.bind(this),mouseRightDownEvent:this._mouseRightDownEvent.bind(this),mouseLeaveEvent:this._mouseLeaveEvent.bind(this),mouseMoveEvent:this._mouseMoveEvent.bind(this),mouseWheelEvent:this._mouseWheelEvent.bind(this),pressedMouseMoveEvent:this._pressedMouseMoveEvent.bind(this),longTapEvent:this._longTapEvent.bind(this)},{treatVertTouchDragAsPageScroll:!0,treatHorzTouchDragAsPageScroll:!1}),this._boundKeyBoardDownEvent=this._keyBoardDownEvent.bind(this),this._target.addEventListener("keydown",this._boundKeyBoardDownEvent),this._boundContextMenuEvent=function(t){t.preventDefault()},this._target.addEventListener("contextmenu",this._boundContextMenuEvent,!1),this._zoomScrollEventHandler=new je(i),this._overlayEventHandler=new Xe(i,a),this._keyBoardEventHandler=new qe(i)}return r(t,[{key:"_keyBoardDownEvent",value:function(t){this._keyBoardEventHandler.keyBoardDownEvent(t)}},{key:"_pinchStartEvent",value:function(){this._zoomScrollEventHandler.pinchStartEvent()}},{key:"_pinchEvent",value:function(t,e){this._zoomScrollEventHandler.pinchEvent(t,e)}},{key:"_mouseUpEvent",value:function(t){this._checkEventInChartContent(t)&&(this._target.style.cursor="crosshair"),this._zoomScrollEventHandler.mouseUpEvent(t),this._shouldPerformOverlayEvent()&&this._overlayEventHandler.mouseUpEvent(t)}},{key:"_mouseLeaveEvent",value:function(t){this._zoomScrollEventHandler.mouseLeaveEvent(t)}},{key:"_mouseMoveEvent",value:function(t){if(t.target instanceof HTMLCanvasElement)if(this._checkEventInChartContent(t)){this._target.style.cursor="crosshair";var e=this._compatChartEvent(t,!0);this._shouldPerformOverlayEvent()&&this._overlayEventHandler.mouseMoveEvent(e),this._chartStore.dragPaneFlag()||this._zoomScrollEventHandler.mouseMoveEvent(e)}else this._target.style.cursor="default",this._zoomScrollEventHandler.mouseLeaveEvent(t);else this._target.style.cursor="default",this._chartStore.crosshairStore().set()}},{key:"_mouseWheelEvent",value:function(t){this._checkZoomScroll()&&this._checkEventInChartContent(t)&&this._zoomScrollEventHandler.mouseWheelEvent(this._compatChartEvent(t))}},{key:"_mouseClickEvent",value:function(t){this._checkZoomScroll()&&this._checkEventInChartContent(t)&&(this._zoomScrollEventHandler.mouseClickEvent(this._compatChartEvent(t,!0)),this._modifyEventOptions(t))}},{key:"_mouseDownEvent",value:function(t){if(this._checkEventInChartContent(t)){this._target.style.cursor="pointer";var e=this._compatChartEvent(t,!0);this._shouldPerformOverlayEvent()&&this._overlayEventHandler.mouseDownEvent(e),this._checkZoomScroll()&&(this._zoomScrollEventHandler.mouseDownEvent(e),this._modifyEventOptions(t))}}},{key:"_mouseRightDownEvent",value:function(t){this._shouldPerformOverlayEvent()&&this._checkEventInChartContent(t)&&this._overlayEventHandler.mouseRightDownEvent(this._compatChartEvent(t,!0))}},{key:"_pressedMouseMoveEvent",value:function(t){if(this._checkEventInChartContent(t)){var e=this._compatChartEvent(t,!0);this._checkZoomScroll()?(this._zoomScrollEventHandler.pressedMouseMoveEvent(e),this._modifyEventOptions(t)):this._overlayEventHandler.pressedMouseMoveEvent(e)}}},{key:"_longTapEvent",value:function(t){this._checkZoomScroll()&&this._checkEventInChartContent(t)&&(this._zoomScrollEventHandler.longTapEvent(this._compatChartEvent(t,!0)),this._modifyEventOptions(t))}},{key:"_checkZoomScroll",value:function(){return!this._chartStore.dragPaneFlag()&&!this._chartStore.shapeStore().isPressed()&&!this._chartStore.shapeStore().isDrawing()}},{key:"_shouldPerformOverlayEvent",value:function(){return!this._chartStore.shapeStore().isEmpty()||!this._chartStore.annotationStore().isEmpty()}},{key:"_modifyEventOptions",value:function(t){Le(t)&&this._chartStore.crosshairStore().get().paneId?this._event.setOptions({treatVertTouchDragAsPageScroll:!1}):this._event.setOptions({treatVertTouchDragAsPageScroll:!0})}},{key:"_compatChartEvent",value:function(t,e){if(e)for(var i in this._paneContentSize)if(Object.prototype.hasOwnProperty.call(this._paneContentSize,i)){var a=this._paneContentSize[i];if(t.localY>a.contentTop&&a.contentBottom>t.localY){t.paneY=t.localY-a.contentTop,t.paneId=i;break}}return t.localX-=this._chartContentLeftRight.contentLeft,t}},{key:"_checkEventInChartContent",value:function(t){return t.localX>this._chartContentLeftRight.contentLeft&&this._chartContentLeftRight.contentRight>t.localX&&t.localY>this._chartContentTopBottom.contentTop&&this._chartContentTopBottom.contentBottom>t.localY}},{key:"setChartContentLeftRight",value:function(t){this._chartContentLeftRight=t}},{key:"setChartContentTopBottom",value:function(t){this._chartContentTopBottom=t}},{key:"setPaneContentSize",value:function(t){this._paneContentSize=t}},{key:"destroy",value:function(){this._event.destroy(),this._target.removeEventListener("keydown",this._boundKeyBoardDownEvent),this._target.removeEventListener("contextmenu",this._boundContextMenuEvent)}}]),t}();function Je(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,i=0;return function(){var a=Date.now(),n=this,s=arguments;a-i>e&&(t.apply(n,s),i=a)}}var Qe=function(t){c(i,t);var e=_(i);function i(t){var a,n=t.id,o=t.point,r=t.chartStore,h=t.xAxis,c=t.yAxis,l=t.styles;return s(this,i),(a=e.call(this,{id:n,chartStore:r,xAxis:h,yAxis:c}))._point=o,a._symbolCoordinate={},a.setStyles(l,r.styleOptions().annotation),a}return r(i,[{key:"_drawSymbol",value:function(t,e,i){var a=this._chartStore.timeScaleStore().barSpace(),n=i.symbol,s=n.size,o=n.activeSize,r=e?w(o)?o:a:w(s)?s:a,h=e?n.activeColor:n.color;switch(n.type){case G:gt(t,h,this._symbolCoordinate,r/2);break;case Z:!function(t,e,i,a,n,s){t.fillStyle=e,t.fillRect(i,a,n,s)}(t,h,this._symbolCoordinate.x-r/2,this._symbolCoordinate.y-r/2,r,r);break;case K:!function(t,e,i,a,n){t.fillStyle=e,t.beginPath(),t.moveTo(i.x-a/2,i.y),t.lineTo(i.x,i.y-n/2),t.lineTo(i.x+a/2,i.y),t.lineTo(i.x,i.y+n/2),t.closePath(),t.fill()}(t,h,this._symbolCoordinate,r,r);break;case U:!function(t,e,i,a,n){t.fillStyle=e,t.beginPath(),t.moveTo(i.x-a/2,i.y+n/2),t.lineTo(i.x,i.y-n/2),t.lineTo(i.x+a/2,i.y+n/2),t.closePath(),t.fill()}(t,h,this._symbolCoordinate,r,r);break;case q:t.save(),this.drawCustomSymbol({ctx:t,point:this._point,coordinate:this._symbolCoordinate,viewport:{width:this._xAxis.width(),height:this._yAxis.height(),barSpace:a},styles:n,isActive:e}),t.restore()}}},{key:"draw",value:function(t){var e=this._styles||this._chartStore.styleOptions().annotation,i=e.offset||[0,0],a=0;switch(e.position){case $:a=this._yAxis.convertToPixel(this._point.value);break;case J:a=0;break;case Q:a=this._yAxis.height()}this._symbolCoordinate.y=a+i[0];var n=this._id===this._chartStore.annotationStore().mouseOperate().id;this._drawSymbol(t,n,e),this.drawExtend&&(t.save(),this.drawExtend({ctx:t,point:this._point,coordinate:this._symbolCoordinate,viewport:{width:this._xAxis.width(),height:this._yAxis.height()},styles:e,isActive:n}),t.restore())}},{key:"checkEventCoordinateOn",value:function(t){var e,i,a,n,s,o=this._chartStore.timeScaleStore().barSpace(),r=(this._styles||this._chartStore.styleOptions().annotation).symbol,h=w(r.size)?r.size:o;switch(r.type){case G:e=kt(this._symbolCoordinate,h/2,t);break;case Z:e=function(t,e,i){return!(t.x>i.x||i.x>e.x||t.y>i.y||i.y>e.y)}({x:this._symbolCoordinate.x-h/2,y:this._symbolCoordinate.y-h/2},{x:this._symbolCoordinate.x+h/2,y:this._symbolCoordinate.y+h/2},t);break;case K:e=(a=h)*(n=h)/2+2>Math.abs((i=this._symbolCoordinate).x-(s=t).x)*n+Math.abs(i.y-s.y)*a;break;case U:e=function(t,e){var i=St(t[0],t[1],t[2]),a=St(t[0],t[1],e)+St(t[0],t[2],e)+St(t[1],t[2],e);return 2>Math.abs(i-a)}([{x:this._symbolCoordinate.x-h/2,y:this._symbolCoordinate.y+h/2},{x:this._symbolCoordinate.x,y:this._symbolCoordinate.y-h/2},{x:this._symbolCoordinate.x+h/2,y:this._symbolCoordinate.y+h/2}],t);break;case q:e=this.checkEventCoordinateOnCustomSymbol({eventCoordinate:t,coordinate:this._symbolCoordinate,size:h})}if(e)return{id:this._id,instance:this}}},{key:"createSymbolCoordinate",value:function(t){var e=this._styles||this._chartStore.styleOptions().annotation;this._symbolCoordinate={x:t+(e.offset||[0,0])[1]}}},{key:"points",value:function(){return this._point}},{key:"checkEventCoordinateOnCustomSymbol",value:function(t){}},{key:"drawCustomSymbol",value:function(t){}}]),i}(xt),ti=function(t){c(i,t);var e=_(i);function i(t){var a,n=t.id,o=t.point,r=t.text,h=t.mark,c=t.chartStore,l=t.xAxis,u=t.yAxis,d=t.styles;return s(this,i),(a=e.call(this,{id:n,chartStore:c,xAxis:l,yAxis:u}))._point=o||{},a._text=r,a._mark=h,a.setStyles(d,c.styleOptions().tag),a}return r(i,[{key:"update",value:function(t){var e=t.point,i=t.text,a=t.mark,n=t.styles,s=!1;return k(e)&&(this._point=e,s=!0),b(i)&&(this._text=i,s=!0),b(a)&&(this._mark=a,s=!0),this.setStyles(n,this._chartStore.styleOptions().tag)&&(s=!0),s}},{key:"drawMarkLine",value:function(t){var e=this._chartStore.styleOptions(),i=e.yAxis,a=this._styles||e.tag,n=this._getY(a);t.save(),this._drawLine(t,n,a,i),this._drawMark(t,n,a,i),t.restore()}},{key:"drawText",value:function(t){if(b(this._text)){var e=this._chartStore.styleOptions(),i=this._styles||e.tag,a=i.text;t.save();var n,s=Dt(t,this._text,a),o=Lt(a);n=this._yAxis.isFromYAxisZero()?0:this._yAxis.width()-s;var r=this._getY(i);de(t,a.backgroundColor,a.borderColor,a.borderSize,n,r-o/2,s,o,a.borderRadius),ce(t,a.color,n+a.paddingLeft,r,this._text),t.restore()}}},{key:"_drawLine",value:function(t,e,i,a){var n=i.line;if(n.show){t.save();var s=Dt(t,this._text,i.text),o=Dt(t,this._mark,i.mark);t.strokeStyle=n.color,t.lineWidth=n.size,n.style===T&&t.setLineDash(n.dashValue);var r=i.mark.offset,h=[],c=b(this._text),l=b(this._mark);a.inside?a.position===M?c&&l?r>0?(h.push([s,s+r]),h.push([s+r+o,this._xAxis.width()])):h.push(Math.min(s,o)>Math.abs(r)?[s+r+o,this._xAxis.width()]:[Math.max(s,o),this._xAxis.width()]):c?h.push([s,this._xAxis.width()]):l?r>0?(h.push([0,r]),h.push([r+o,this._xAxis.width()])):h.push(o>Math.abs(r)?[r+o,this._xAxis.width()]:[0,this._xAxis.width()]):h.push([0,this._xAxis.width()]):c&&l?0>r?(h.push([0,this._xAxis.width()-s+r-o]),h.push([this._xAxis.width()-s+r,this._xAxis.width()-s])):h.push(Math.min(s,o)>r?[0,this._xAxis.width()-s-o+r]:[0,this._xAxis.width()-Math.max(s,o)]):c?h.push([0,this._xAxis.width()-s]):l?0>r?(h.push([0,this._xAxis.width()+r-o]),h.push([this._xAxis.width()+r,this._xAxis.width()])):h.push(o>r?[0,this._xAxis.width()-o+r]:[0,this._xAxis.width()]):h.push([0,this._xAxis.width()]):a.position===M?l?r>0?(h.push([0,r]),h.push([r+o,this._xAxis.width()])):h.push(o>Math.abs(r)?[o+r,this._xAxis.width()]:[0,this._xAxis.width()]):h.push([0,this._xAxis.width()]):l?0>r?(h.push([0,this._xAxis.width()-o+r]),h.push([this._xAxis.width()+r,this._xAxis.width()])):h.push(o>r?[0,this._xAxis.width()-o+r]:[0,this._xAxis.width()]):h.push([0,this._xAxis.width()]),h.forEach((function(i){Pt(t,e,i[0],i[1])})),t.restore()}}},{key:"_drawMark",value:function(t,e,i,a){if(b(this._mark)){var n,s=i.mark,o=Dt(t,this._mark,s),r=Lt(s);if(a.inside){var h=0;b(this._text)&&(h=Dt(t,this._text,i.text)),n=a.position===M?h:this._xAxis.width()-h-o}else n=a.position===M?0:this._xAxis.width()-o;de(t,s.backgroundColor,s.borderColor,s.borderSize,n+=s.offset,e-r/2,o,r,s.borderRadius),t.textBaseline="middle",t.font=Mt(s.size,s.weight,s.family),ce(t,s.color,n+s.paddingLeft,e,this._mark)}}},{key:"_getY",value:function(t){var e=t.offset;switch(t.position){case J:return e;case Q:return this._yAxis.height()+e;default:return this._yAxis.convertToNicePixel(this._point.value)+e}}}]),i}(xt),ei="technical_indicator_pane_",ii="candle_pane",ai=function(){function t(e,i){var a=this;s(this,t),this._initChartContainer(e),this._shapeBaseId=0,this._paneBaseId=0,this._separatorDragStartTopPaneHeight=0,this._separatorDragStartBottomPaneHeight=0,this._chartStore=new ie(i,{invalidate:this._invalidatePane.bind(this),crosshair:this._crosshairObserver.bind(this)}),this._xAxisPane=new Ie({id:"x_axis_pane",container:this._chartContainer,chartStore:this._chartStore}),this._panes=new Map([[ii,new Ee({container:this._chartContainer,chartStore:this._chartStore,xAxis:this._xAxisPane.xAxis(),id:ii})]]),this._separators=new Map,this._chartWidth={},this._chartHeight={},this._chartEvent=new $e(this._chartContainer,this._chartStore,(function(t){return a._panes.get(t).yAxis()})),this.adjustPaneViewport(!0,!0,!0)}return r(t,[{key:"_initChartContainer",value:function(t){this._container=t,this._chartContainer=ae("div",{userSelect:"none",webkitUserSelect:"none",msUserSelect:"none",MozUserSelect:"none",webkitTapHighlightColor:"transparent",position:"relative",outline:"none",borderStyle:"none",width:"100%",cursor:"crosshair",boxSizing:"border-box"}),this._chartContainer.tabIndex=1,t.appendChild(this._chartContainer)}},{key:"_crosshairObserver",value:function(t){var e=this,i=t.crosshair,a=t.dataIndex,n=t.kLineData,s=t.x,o=t.y;if(this._chartStore.actionStore().has(ht.CROSSHAIR)||this._chartStore.actionStore().has(ht.TOOLTIP)){var r={};this._panes.forEach((function(t,i){var s={},o=[];e.chartStore().technicalIndicatorStore().instances(i).forEach((function(t){var e=t.result[a];s[t.name]=e,o.push({name:t.name,data:e})})),r[i]=s,e._chartStore.actionStore().execute(ht.TOOLTIP,{paneId:i,dataIndex:a,kLineData:n,technicalIndicatorData:o})})),i.paneId&&this._chartStore.actionStore().execute(ht.CROSSHAIR,{coordinate:{x:s,y:o},dataIndex:a,kLineData:n,technicalIndicatorData:r})}}},{key:"_separatorStartDrag",value:function(t,e){this._separatorDragStartTopPaneHeight=this._panes.get(t).height(),this._separatorDragStartBottomPaneHeight=this._panes.get(e).height()}},{key:"_separatorDrag",value:function(t,e,i){var a=this._separatorDragStartTopPaneHeight+t,n=this._separatorDragStartBottomPaneHeight-t;a>this._separatorDragStartTopPaneHeight+this._separatorDragStartBottomPaneHeight&&(a=this._separatorDragStartTopPaneHeight+this._separatorDragStartBottomPaneHeight,n=0),0>a&&(a=0,n=this._separatorDragStartTopPaneHeight+this._separatorDragStartBottomPaneHeight),this._panes.get(e).setHeight(a),this._panes.get(i).setHeight(n),this._chartStore.actionStore().execute(ht.PANE_DRAG,{topPaneId:e,bottomPaneId:i,topPaneHeight:a,bottomPaneHeight:n}),this.adjustPaneViewport(!0,!0,!0,!0,!0)}},{key:"_invalidatePane",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Kt;if(t===Zt)this._xAxisPane.invalidate(t),this._panes.forEach((function(e){e.invalidate(t)}));else{var e=!1;this._panes.forEach((function(t){var i=t.yAxis().computeAxis();i&&(e=i)})),this.adjustPaneViewport(!1,e,!0)}}},{key:"_measurePaneHeight",value:function(){var t=this,e=this._chartStore.styleOptions(),i=this._container.offsetHeight,a=e.separator.size,n=a*this._separators.size,s=this._xAxisPane.xAxis().getSelfHeight(),o=i-s-n,r=0;this._panes.forEach((function(t){if(t.id()!==ii){var e=t.height();r+e>o?(t.setHeight(o-r),r=o):r+=e}}));var h=o-r,c={};c.candle_pane={contentTop:0,contentBottom:h};var l=h,u=h;this._panes.get(ii).setHeight(h),this._chartHeight.candle_pane=h,this._panes.forEach((function(e){if(e.id()!==ii){var i=e.height();u+=i+a,c[e.id()]={contentTop:l,contentBottom:u},t._chartHeight[e.id()]=i,l=u}})),this._xAxisPane.setHeight(s),this._chartHeight.xAxis=s,this._chartHeight.total=i,this._chartEvent.setPaneContentSize(c),this._chartEvent.setChartContentTopBottom({contentTop:0,contentBottom:u})}},{key:"_measurePaneWidth",value:function(){var t,e,i,a=this,n=this._chartStore.styleOptions().yAxis,s=n.position===M,o=this._container.offsetWidth,r=Number.MIN_SAFE_INTEGER;!n.inside?(this._panes.forEach((function(t){r=Math.max(r,t.yAxis().getSelfWidth())})),t=o-r,s?(e=0,i=r):(i=0,e=o-r)):(t=o,r=o,e=0,i=0),this._chartStore.timeScaleStore().setTotalDataSpace(t),this._panes.forEach((function(n,s){n.setWidth(t,r),n.setOffsetLeft(i,e);var o=a._separators.get(s);o&&o.setSize(i,t)})),this._chartWidth={content:t,yAxis:r,total:o},this._xAxisPane.setWidth(t,r),this._xAxisPane.setOffsetLeft(i,e),this._chartEvent.setChartContentLeftRight({contentLeft:i,contentRight:i+t})}},{key:"adjustPaneViewport",value:function(t,e,i,a,n){t&&this._measurePaneHeight();var s=!1;a&&this._panes.forEach((function(t){var e=t.yAxis().computeAxis(n);s||(s=e)})),(!a&&e||a&&s)&&this._measurePaneWidth(),i&&(this._xAxisPane.xAxis().computeAxis(!0),this._xAxisPane.layout(),this._panes.forEach((function(t){t.layout()})))}},{key:"hasPane",value:function(t){return this._panes.has(t)}},{key:"getPane",value:function(t){return this._panes.get(t)}},{key:"chartStore",value:function(){return this._chartStore}},{key:"removeTechnicalIndicator",value:function(t,e){var i=this;if(this._chartStore.technicalIndicatorStore().removeInstance(t,e)){var a=!1;if(t!==ii&&!this._chartStore.technicalIndicatorStore().hasInstance(t)){a=!0,this._panes.get(t).destroy();var n=this._separators.get(t).topPaneId();this._separators.get(t).destroy(),this._panes.delete(t),this._separators.delete(t),this._separators.forEach((function(t){var e=t.topPaneId();i._separators.has(e)||t.updatePaneId(n)}))}this.adjustPaneViewport(a,!0,!0,!0,!0)}}},{key:"createTechnicalIndicator",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._panes.has(i.id)){var a=!1;return this._chartStore.technicalIndicatorStore().addInstance(i.id,t,e)&&(a=this._panes.get(i.id).yAxis().computeAxis()),this.setPaneOptions(i,a),i.id}var n=i.id||"".concat(ei).concat(++this._paneBaseId),s=!E(i.dragEnabled)||i.dragEnabled;this._separators.set(n,new We(this._chartContainer,this._chartStore,Array.from(this._panes.keys()).pop(),n,s,{startDrag:this._separatorStartDrag.bind(this),drag:Je(this._separatorDrag.bind(this),50)}));var o=new Se({container:this._chartContainer,chartStore:this._chartStore,xAxis:this._xAxisPane.xAxis(),id:n,height:i.height||100});return this._panes.set(n,o),this._chartStore.technicalIndicatorStore().addInstance(n,t,e),this.adjustPaneViewport(!0,!0,!0,!0,!0),n}},{key:"createShape",value:function(t,e,i){var a=e.points,n=e.styles,s=e.lock,o=e.data,r=e.onDrawStart,h=e.onDrawing,c=e.onDrawEnd,l=e.onClick,u=e.onRightClick,d=e.onPressedMove,_=e.onMouseEnter,v=e.onMouseLeave,f=e.onRemove,p=e.id||"".concat("shape_").concat(++this._shapeBaseId);if(!this._chartStore.shapeStore().hasInstance(p)){var m=null;this.hasPane(i)?m=this._panes.get(i).yAxis():a&&a.length>0&&(i=ii,m=this._panes.get(ii).yAxis());var y=new t({id:p,chartStore:this._chartStore,xAxis:this._xAxisPane.xAxis(),yAxis:m,points:a,styles:n,lock:s,data:o});return S(r)&&r({id:p}),yt(y,[{key:"onDrawing",fn:h},{key:"onDrawEnd",fn:c},{key:"onClick",fn:l},{key:"onRightClick",fn:u},{key:"onPressedMove",fn:d},{key:"onMouseEnter",fn:_},{key:"onMouseLeave",fn:v},{key:"onRemove",fn:f}]),this._chartStore.shapeStore().addInstance(y,i),p}return null}},{key:"createAnnotation",value:function(t,e){var i=this,a=[];t.forEach((function(t){var n=t.point,s=t.styles,o=t.checkEventCoordinateOnCustomSymbol,r=t.drawCustomSymbol,h=t.drawExtend,c=t.onClick,l=t.onRightClick,u=t.onMouseEnter,d=t.onMouseLeave;if(n&&n.timestamp){var _=new Qe({id:n.timestamp,chartStore:i._chartStore,point:n,xAxis:i._xAxisPane.xAxis(),yAxis:i._panes.get(e).yAxis(),styles:s});yt(_,[{key:"drawExtend",fn:h},{key:"drawCustomSymbol",fn:r},{key:"checkEventCoordinateOnCustomSymbol",fn:o},{key:"onClick",fn:c},{key:"onRightClick",fn:l},{key:"onMouseEnter",fn:u},{key:"onMouseLeave",fn:d}]),a.push(_)}})),a.length>0&&this._chartStore.annotationStore().add(a,e)}},{key:"createTag",value:function(t,e){var i=this,a=[],n=!1,s=!1;t.forEach((function(t){var o=t.id,r=t.point,h=t.text,c=t.mark,l=t.styles;if(b(o))if(i._chartStore.tagStore().has(o,e)){var u=i._chartStore.tagStore().update(o,e,{point:r,text:h,mark:c,styles:l});n||(n=u)}else s=!0,a.push(new ti({id:o,point:r,text:h,mark:c,styles:l,chartStore:i._chartStore,xAxis:i._xAxisPane.xAxis(),yAxis:i._panes.get(e).yAxis()}))})),s?this._chartStore.tagStore().add(a,e):n&&this._invalidatePane(Zt)}},{key:"removeAllHtml",value:function(){this._panes.forEach((function(t){t.removeHtml()})),this._xAxisPane.removeHtml()}},{key:"setPaneOptions",value:function(t,e){var i=e,a=!1;if(t.id!==ii){var n=this._panes.get(t.id);n&&(w(t.height)&&t.height>0&&n.height()!==t.height&&(i=!0,n.setHeight(t.height),a=!0),E(t.dragEnabled)&&this._separators.get(t.id).setDragEnabled(t.dragEnabled))}i&&this.adjustPaneViewport(a,!0,!0,!0,!0)}},{key:"setTimezone",value:function(t){this._chartStore.timeScaleStore().setTimezone(t),this._xAxisPane.xAxis().computeAxis(!0),this._xAxisPane.invalidate(Kt)}},{key:"convertToPixel",value:function(t,e){var i,a=this,n=e.paneId,s=void 0===n?ii:n,o=e.absoluteYAxis,r=[].concat(t),h=[],c=this._chartStore.styleOptions().separator.size,l=0,u=m(this._panes.values());try{var d=function(){var t=i.value;if(t.id()===s)return h=r.map((function(e){var i=e.timestamp,n=e.value,s={},r=e.dataIndex;if(b(i)&&(r=a._chartStore.timeScaleStore().timestampToDataIndex(i)),b(r)&&(s.x=a._xAxisPane.xAxis().convertToPixel(r)),b(n)){var h=t.yAxis().convertToPixel(n);s.y=o?l+h:h}return s})),"break";l+=t.height()+c};for(u.s();!(i=u.n()).done;){if("break"===d())break}}catch(t){u.e(t)}finally{u.f()}return g(t)?h:h[0]||{}}},{key:"convertFromPixel",value:function(t,e){var i,a=this,n=e.paneId,s=void 0===n?ii:n,o=e.absoluteYAxis,r=[].concat(t),h=[],c=this._chartStore.styleOptions().separator.size,l=0,u=m(this._panes.values());try{var d=function(){var t=i.value;if(t.id()===s)return h=r.map((function(e){var i=e.x,n=e.y,s={};if(b(i)&&(s.dataIndex=a._xAxisPane.xAxis().convertFromPixel(i),s.timestamp=a._chartStore.timeScaleStore().dataIndexToTimestamp(s.dataIndex)),b(n)){var r=o?n-l:n;s.value=t.yAxis().convertFromPixel(r)}return s})),"break";l+=t.height()+c};for(u.s();!(i=u.n()).done;){if("break"===d())break}}catch(t){u.e(t)}finally{u.f()}return g(t)?h:h[0]||{}}},{key:"chartWidth",value:function(){return this._chartWidth}},{key:"chartHeight",value:function(){return this._chartHeight}},{key:"getConvertPictureUrl",value:function(t,e,i){var a=this,n=this._chartContainer.offsetWidth,s=this._chartContainer.offsetHeight,o=ae("canvas",{width:"".concat(n,"px"),height:"".concat(s,"px"),boxSizing:"border-box"}),r=o.getContext("2d"),h=Tt(o);o.width=n*h,o.height=s*h,r.scale(h,h),r.fillStyle=i,r.fillRect(0,0,n,s);var c=0;return this._panes.forEach((function(e,i){if(i!==ii){var s=a._separators.get(i);r.drawImage(s.getImage(),0,c,n,s.height()),c+=s.height()}r.drawImage(e.getImage(t),0,c,n,e.height()),c+=e.height()})),r.drawImage(this._xAxisPane.getImage(t),0,c,n,this._xAxisPane.height()),o.toDataURL("image/".concat(e))}},{key:"destroy",value:function(){this._panes.forEach((function(t){t.destroy()})),this._separators.forEach((function(t){t.destroy()})),this._panes.clear(),this._separators.clear(),this._xAxisPane.destroy(),this._container.removeChild(this._chartContainer),this._chartEvent.destroy()}}]),t}(),ni=function(){function t(e,i){s(this,t),this._chartPane=new ai(e,i)}return r(t,[{key:"getWidth",value:function(){return this._chartPane.chartWidth()}},{key:"getHeight",value:function(){return this._chartPane.chartHeight()}},{key:"setStyleOptions",value:function(t){k(t)&&(this._chartPane.chartStore().applyStyleOptions(t),this._chartPane.adjustPaneViewport(!0,!0,!0,!0,!0))}},{key:"getStyleOptions",value:function(){return x(this._chartPane.chartStore().styleOptions())}},{key:"setPriceVolumePrecision",value:function(t,e){w(t)&&t>=0&&w(e)&&e>=0&&this._chartPane.chartStore().setPriceVolumePrecision(t,e)}},{key:"setTimezone",value:function(t){this._chartPane.setTimezone(t)}},{key:"getTimezone",value:function(){return this._chartPane.chartStore().timeScaleStore().timezone()}},{key:"resize",value:function(){this._chartPane.adjustPaneViewport(!0,!0,!0,!0,!0)}},{key:"setOffsetRightSpace",value:function(t){w(t)&&this._chartPane.chartStore().timeScaleStore().setOffsetRightSpace(t,!0)}},{key:"setLeftMinVisibleBarCount",value:function(t){w(t)&&t>0&&this._chartPane.chartStore().timeScaleStore().setLeftMinVisibleBarCount(Math.ceil(t))}},{key:"setRightMinVisibleBarCount",value:function(t){w(t)&&t>0&&this._chartPane.chartStore().timeScaleStore().setRightMinVisibleBarCount(Math.ceil(t))}},{key:"setDataSpace",value:function(t){w(t)&&this._chartPane.chartStore().timeScaleStore().setDataSpace(t)}},{key:"getDataSpace",value:function(){return this._chartPane.chartStore().timeScaleStore().dataSpace()}},{key:"getBarSpace",value:function(){return this._chartPane.chartStore().timeScaleStore().barSpace()}},{key:"clearData",value:function(){this._chartPane.chartStore().clearDataList()}},{key:"getDataList",value:function(){return this._chartPane.chartStore().dataList()}},{key:"applyNewData",value:function(t,e){var i=this;if(g(t)){var a=this._chartPane.chartStore();a.clearDataList(),a.addData(t,0,e),Promise.resolve(a.technicalIndicatorStore().calcInstance()).finally((function(t){i._chartPane.adjustPaneViewport(!1,!0,!0,!0)}))}}},{key:"applyMoreData",value:function(t,e){var i=this;if(g(t)){var a=this._chartPane.chartStore();a.addData(t,0,e),Promise.resolve(a.technicalIndicatorStore().calcInstance()).finally((function(t){i._chartPane.adjustPaneViewport(!1,!0,!0,!0)}))}}},{key:"updateData",value:function(t){var e=this;if(k(t)&&!g(t)){var i=this._chartPane.chartStore(),a=i.dataList(),n=a.length,s=et(t,"timestamp",0),o=et(a[n-1],"timestamp",0);if(s>=o){var r=n;s===o&&(r=n-1),i.addData(t,r),Promise.resolve(i.technicalIndicatorStore().calcInstance()).finally((function(t){e._chartPane.adjustPaneViewport(!1,!0,!0,!0)}))}}}},{key:"loadMore",value:function(t){S(t)&&this._chartPane.chartStore().timeScaleStore().setLoadMoreCallback(t)}},{key:"createTechnicalIndicator",value:function(t,e,i){if(!b(t))return null;var a=k(t)&&!g(t)?t:{name:t};return this._chartPane.chartStore().technicalIndicatorStore().hasTemplate(a.name)?this._chartPane.createTechnicalIndicator(a,e,i):null}},{key:"addTechnicalIndicatorTemplate",value:function(t){if(k(t)){var e=[].concat(t);this._chartPane.chartStore().technicalIndicatorStore().addTemplate(e)}}},{key:"overrideTechnicalIndicator",value:function(t,e){var i=this;if(k(t)&&!g(t)){var a=this._chartPane.chartStore().technicalIndicatorStore().override(t,e);a&&a.then((function(t){i._chartPane.adjustPaneViewport(!1,!0,!0,!0)}))}}},{key:"getTechnicalIndicatorTemplate",value:function(t){return this._chartPane.chartStore().technicalIndicatorStore().getTemplateInfo(t)}},{key:"getTechnicalIndicatorByPaneId",value:function(t,e){return this._chartPane.chartStore().technicalIndicatorStore().getInstanceInfo(t,e)}},{key:"removeTechnicalIndicator",value:function(t,e){this._chartPane.removeTechnicalIndicator(t,e)}},{key:"addShapeTemplate",value:function(t){if(k(t)){var e=[].concat(t);this._chartPane.chartStore().shapeStore().addTemplate(e)}}},{key:"createShape",value:function(t,e){if(!b(t))return null;var i=k(t)&&!g(t)?t:{name:t},a=this._chartPane.chartStore().shapeStore().getTemplate(i.name);return a?this._chartPane.createShape(a,i,e):null}},{key:"getShape",value:function(t){return this._chartPane.chartStore().shapeStore().getInstanceInfo(t)}},{key:"setShapeOptions",value:function(t){k(t)&&!g(t)&&this._chartPane.chartStore().shapeStore().setInstanceOptions(t)}},{key:"removeShape",value:function(t){this._chartPane.chartStore().shapeStore().removeInstance(t)}},{key:"createAnnotation",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ii;if(k(t)&&this._chartPane.hasPane(e)){var i=[].concat(t);this._chartPane.createAnnotation(i,e)}}},{key:"removeAnnotation",value:function(t,e){this._chartPane.chartStore().annotationStore().remove(t,e)}},{key:"createTag",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ii;if(k(t)&&this._chartPane.hasPane(e)){var i=[].concat(t);this._chartPane.createTag(i,e)}}},{key:"removeTag",value:function(t,e){this._chartPane.chartStore().tagStore().remove(t,e)}},{key:"createHtml",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ii;if(!k(t))return null;if(!(P(t.content)||t.content instanceof HTMLElement))return null;var i=this._chartPane.getPane(e);return i?i.createHtml(t):null}},{key:"removeHtml",value:function(t,e){if(t){var i=this._chartPane.getPane(t);i&&i.removeHtml(e)}else this._chartPane.removeAllHtml()}},{key:"setPaneOptions",value:function(t){k(t)&&this._chartPane.setPaneOptions(t,!1)}},{key:"setZoomEnabled",value:function(t){this._chartPane.chartStore().timeScaleStore().setZoomEnabled(t)}},{key:"isZoomEnabled",value:function(){return this._chartPane.chartStore().timeScaleStore().zoomEnabled()}},{key:"setScrollEnabled",value:function(t){this._chartPane.chartStore().timeScaleStore().setScrollEnabled(t)}},{key:"isScrollEnabled",value:function(){return this._chartPane.chartStore().timeScaleStore().scrollEnabled()}},{key:"scrollByDistance",value:function(t,e){var i=this;if(w(t))if(w(e)&&e>0){this._chartPane.chartStore().timeScaleStore().startScroll();var a=(new Date).getTime();!function n(){var s=((new Date).getTime()-a)/e,o=s>=1,r=o?t:t*s;i._chartPane.chartStore().timeScaleStore().scroll(r),o||oe(n)}()}else this._chartPane.chartStore().timeScaleStore().startScroll(),this._chartPane.chartStore().timeScaleStore().scroll(t)}},{key:"scrollToRealTime",value:function(t){var e=(this._chartPane.chartStore().timeScaleStore().offsetRightBarCount()-this._chartPane.chartStore().timeScaleStore().offsetRightSpace()/this._chartPane.chartStore().timeScaleStore().dataSpace())*this._chartPane.chartStore().timeScaleStore().dataSpace();this.scrollByDistance(e,t)}},{key:"scrollToDataIndex",value:function(t,e){if(w(t)){var i=(this._chartPane.chartStore().dataList().length-1-t)*this._chartPane.chartStore().timeScaleStore().dataSpace();this.scrollByDistance(i,e)}}},{key:"zoomAtCoordinate",value:function(t,e,i){var a=this;if(w(t))if(w(i)&&i>0){var n=this._chartPane.chartStore().timeScaleStore().dataSpace(),s=n*t-n,o=(new Date).getTime();!function t(){var r=((new Date).getTime()-o)/i,h=r>=1,c=h?s:s*r;a._chartPane.chartStore().timeScaleStore().zoom(c/n,e),h||oe(t)}()}else this._chartPane.chartStore().timeScaleStore().zoom(t,e)}},{key:"zoomAtDataIndex",value:function(t,e,i){if(w(t)&&w(e)){var a=this._chartPane.chartStore().timeScaleStore().dataIndexToCoordinate(e);this.zoomAtCoordinate(t,{x:a},i)}}},{key:"convertToPixel",value:function(t,e){return this._chartPane.convertToPixel(t,e)}},{key:"convertFromPixel",value:function(t,e){return this._chartPane.convertFromPixel(t,e)}},{key:"subscribeAction",value:function(t,e){this._chartPane.chartStore().actionStore().subscribe(t,e)}},{key:"unsubscribeAction",value:function(t,e){this._chartPane.chartStore().actionStore().unsubscribe(t,e)}},{key:"getConvertPictureUrl",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"jpeg",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#FFFFFF";if("png"===e||"jpeg"===e||"bmp"===e)return this._chartPane.getConvertPictureUrl(t,e,i)}},{key:"destroy",value:function(){this._chartPane.destroy()}}]),t}(),si={},oi=1,ri="k_line_chart_";t.dispose=function(t){if(t){var e;if(P(t)){var i=document.getElementById(t);e=i&&i.chartId}else e=t instanceof ni?t.id:t&&t.chartId;e&&(si[e].destroy(),delete si[e])}},t.extension=e,t.init=function(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t)return null;if(!(e=P(t)?document.getElementById(t):t))return null;var a=si[e.chartId||""];if(a)return a;var n="".concat(ri).concat(oi++);return(a=new ni(e,i)).id=n,e.chartId=n,si[n]=a,a},t.version=function(){return"8.2.0"},Object.defineProperty(t,"__esModule",{value:!0})}));
